<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서울고등학교 캠퍼스 안내</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            /* Modern Clean Colors */
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --secondary: #64748b;

            /* Background - Light Theme */
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --bg-card: #ffffff;
            --bg-glass: rgba(255, 255, 255, 0.8);

            /* Text Colors */
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #94a3b8;
            --text-muted: #cbd5e1;

            /* Accent Colors */
            --accent-blue: #3b82f6;
            --accent-indigo: #6366f1;
            --accent-slate: #64748b;
            --accent-gray: #9ca3af;

            /* Semantic Colors */
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-card: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);

            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;

            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Subtle Background Pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(180deg, rgba(59, 130, 246, 0.02) 0%, transparent 100%);
            pointer-events: none;
            z-index: 0;
        }

        /* Header - Slim */
        header {
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 2rem;
            position: relative;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            max-width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-text {
            flex: 1;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-primary);
        }

        h1 i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .subtitle {
            display: none;
        }

        /* Search Section - Hidden */
        .search-section {
            display: none;
        }

        .search-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .search-box {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem 3rem 1rem 3.5rem;
            font-size: 1.1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            transition: var(--transition-base);
            font-family: inherit;
            background: var(--bg-primary);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: white;
        }

        .search-input::placeholder {
            color: var(--gray-400);
        }

        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.25rem;
            color: var(--gray-400);
            transition: var(--transition-base);
        }

        .search-input:focus ~ .search-icon {
            color: var(--primary-500);
        }

        .clear-btn {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gray-200);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: var(--transition-base);
            color: var(--gray-600);
        }

        .clear-btn:hover {
            background: var(--gray-300);
            transform: translateY(-50%) scale(1.1);
        }

        .clear-btn:active {
            transform: translateY(-50%) scale(0.95);
        }

        /* Filter Tags */
        .filter-tags {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .filter-tag {
            padding: 0.625rem 1.25rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-full);
            background: var(--bg-primary);
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-base);
            user-select: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .filter-tag i {
            font-size: 0.875rem;
        }

        .filter-tag:hover {
            border-color: var(--primary-500);
            color: var(--primary-500);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .filter-tag.active {
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            border-color: var(--primary-500);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .filter-tag:active {
            transform: translateY(0);
        }

        /* Main Content - Full Screen Layout */
        .main-content {
            display: flex;
            height: calc(100vh - 70px);
            position: relative;
            z-index: 1;
        }

        /* Left Sidebar - Floor Tabs */
        .floor-sidebar {
            width: 80px;
            background: var(--bg-secondary);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 0;
            gap: 1rem;
        }

        .floor-sidebar .floor-btn {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            border: 1px solid #e2e8f0;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-base);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            position: relative;
            overflow: hidden;
        }

        .floor-sidebar .floor-btn::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary);
            opacity: 0;
            transition: var(--transition-base);
        }

        .floor-sidebar .floor-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
            color: var(--primary);
            transform: translateX(5px);
        }

        .floor-sidebar .floor-btn.active {
            background: var(--bg-secondary);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .floor-sidebar .floor-btn.active::before {
            opacity: 1;
        }

        .floor-sidebar .floor-btn span {
            font-size: 0.875rem;
            line-height: 1;
        }

        .floor-sidebar .floor-btn .room-count {
            display: none;
        }

        .sidebar {
            display: none;
        }

        /* Floor Selector (now in filter-tags area) */
        .floor-btn {
            padding: 0.625rem 1.25rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-full);
            background: var(--bg-primary);
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-base);
            user-select: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .floor-btn i {
            font-size: 0.875rem;
        }

        .floor-btn:hover {
            border-color: var(--primary-500);
            color: var(--primary-500);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .floor-btn.active {
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            border-color: var(--primary-500);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .floor-btn:active {
            transform: translateY(0);
        }

        .room-count {
            background: rgba(102, 126, 234, 0.15);
            padding: 0.125rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            margin-left: 0.25rem;
            font-weight: 700;
        }

        .floor-btn.active .room-count {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Map Container - Full Screen */
        .map-container {
            flex: 1;
            background: var(--bg-primary);
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .map-header {
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .map-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .map-title i {
            color: var(--primary-neon);
            font-size: 1.125rem;
        }

        /* Compact Path Controls */
        .path-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
            max-width: 800px;
        }

        .path-select {
            flex: 1;
            max-width: 200px;
            height: 44px;
            background: var(--bg-secondary) !important;
            border: 2px solid #e2e8f0 !important;
            border-radius: var(--radius-md);
            color: var(--text-primary) !important;
            -webkit-text-fill-color: var(--text-primary) !important;
            padding: 10px 40px 10px 16px !important;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            line-height: normal;
            cursor: pointer;
            transition: var(--transition-base);
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%233b82f6' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            vertical-align: middle;
            text-indent: 0;
            box-sizing: border-box;
        }

        /* 모든 브라우저에서 select 선택된 텍스트 색상 강제 */
        select.path-select {
            color: var(--text-primary) !important;
            -webkit-text-fill-color: var(--text-primary) !important;
        }

        select#startLocation,
        select#endLocation {
            color: var(--text-primary) !important;
            -webkit-text-fill-color: var(--text-primary) !important;
        }

        /* Firefox */
        .path-select:-moz-focusring {
            color: transparent;
            text-shadow: 0 0 0 var(--text-primary);
        }

        .path-select option {
            background-color: var(--bg-secondary) !important;
            color: var(--text-primary) !important;
            -webkit-text-fill-color: var(--text-primary) !important;
            padding: 0.75rem;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .path-select option:checked,
        .path-select option:hover {
            background: var(--primary) !important;
            background-color: var(--primary) !important;
            color: #ffffff !important;
            -webkit-text-fill-color: #ffffff !important;
            font-weight: 600;
        }

        .path-select optgroup {
            background-color: var(--bg-tertiary) !important;
            color: var(--primary) !important;
            -webkit-text-fill-color: var(--primary) !important;
            font-weight: 700;
            font-size: 0.85rem;
            padding: 0.5rem;
        }

        .path-select:hover {
            border-color: var(--primary) !important;
            box-shadow: var(--shadow-md);
        }

        .path-select:focus {
            outline: none;
            border-color: var(--primary) !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .path-arrow {
            color: var(--text-tertiary);
            font-size: 1rem;
        }

        .path-btn {
            height: 44px;
            padding: 0 1.5rem;
            background: var(--primary);
            border: none;
            border-radius: var(--radius-md);
            color: #ffffff;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-base);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-sm);
        }

        .path-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .path-btn:active {
            transform: translateY(0);
        }

        .path-btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .path-btn-secondary:hover {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: none;
        }

        .map-controls {
            display: flex;
            gap: 0.5rem;
        }

        .control-btn {
            width: 36px;
            height: 36px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition-base);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .control-btn:hover {
            border-color: var(--primary-neon);
            color: var(--primary-neon);
            background: var(--bg-card);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        /* Floor Map - Full Screen */
        .floor-map {
            display: none;
            flex: 1;
            padding: 2rem;
            overflow: auto;
            animation: fadeIn 0.3s ease-in-out;
        }

        .floor-map.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .floor-plan-container {
            max-width: 100%;
            max-height: 100%;
        }

        /* 층간 이동 시 좌우 분할 화면 */
        .map-container.dual-floor-view {
            display: flex;
            flex-direction: column;
        }

        /* 층간 이동 시 헤더 숨기기 */
        .map-container.dual-floor-view .map-header {
            display: none;
        }

        /* 층간 이동 시 오른쪽 사이드바 숨기기 */
        .map-container.dual-floor-view ~ .rooms-sidebar {
            display: none;
        }

        .dual-floor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            flex: 1;
            overflow: hidden;
        }

        .dual-floor-item {
            background: var(--bg-primary);
            border-right: 1px solid rgba(165, 180, 252, 0.2);
            padding: 0.5rem;
            overflow: auto;
            display: flex;
            flex-direction: column;
        }

        .dual-floor-item:last-child {
            border-right: none;
        }

        .dual-floor-label {
            font-size: 0.875rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-neon) 0%, var(--primary-electric) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.25rem;
            text-align: center;
            padding: 0.375rem;
            border-bottom: 1px solid rgba(165, 180, 252, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .dual-floor-label i {
            background: linear-gradient(135deg, var(--primary-neon) 0%, var(--primary-electric) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .dual-floor-item .floor-map {
            display: flex !important;
            flex: 1;
            justify-content: center;
            align-items: center;
            overflow: visible;
        }

        .dual-floor-item .floor-map svg {
            width: 100%;
            height: 100%;
            max-width: none;
            max-height: none;
        }

        /* 분할 화면 경로 안내 */
        .path-instruction {
            background: rgba(124, 58, 237, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.5);
            border-radius: var(--radius-md);
            padding: 0.5rem 0.75rem;
            margin-bottom: 0.5rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .path-instruction i {
            color: var(--primary-neon);
        }

        /* 층간 이동 애니메이션 */
        .dual-floor-hidden {
            opacity: 0;
            transform: translateX(50px);
        }

        .dual-floor-fadein {
            animation: fadeInSlide 0.5s ease-out forwards;
        }

        @keyframes fadeInSlide {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media (max-width: 1024px) {
            .dual-floor-container {
                grid-template-columns: 1fr;
            }

            .dual-floor-item {
                border-right: none;
                border-bottom: 1px solid rgba(165, 180, 252, 0.2);
            }

            .dual-floor-item:last-child {
                border-bottom: none;
            }
        }

        /* Floor Plan SVG */
        .floor-plan-container {
            background: linear-gradient(135deg, rgba(30, 36, 64, 0.3) 0%, rgba(21, 25, 50, 0.3) 100%);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(165, 180, 252, 0.2);
            width: 100%;
            max-height: 80vh;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.1);
            overflow: auto;
        }

        .floor-image-container {
            background: linear-gradient(135deg, rgba(30, 36, 64, 0.3) 0%, rgba(21, 25, 50, 0.3) 100%);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(165, 180, 252, 0.2);
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.1);
        }

        .floor-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .floor-list-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
            box-shadow: var(--shadow-card);
        }

        .room-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1rem;
        }

        .room-list-item {
            background: var(--bg-primary);
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-md);
            padding: 1.25rem;
            cursor: pointer;
            transition: var(--transition-base);
            display: flex;
            flex-direction: column;
            gap: 0.625rem;
            position: relative;
            overflow: hidden;
        }

        .room-list-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleX(0);
            transition: var(--transition-base);
        }

        .room-list-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .room-list-item:hover::before {
            transform: scaleX(1);
        }

        .room-list-item.selected {
            border-color: var(--success);
            background-color: rgba(16, 185, 129, 0.1);
            box-shadow: var(--shadow-md);
        }

        .room-list-item.selected::before {
            background: var(--success);
            transform: scaleX(1);
        }

        .room-list-item-id {
            font-size: 0.875rem;
            color: var(--text-tertiary);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .room-list-item-id i {
            font-size: 0.75rem;
            color: var(--primary);
        }

        .room-list-item-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.4;
            letter-spacing: -0.01em;
        }

        .room-list-item-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            align-self: flex-start;
            letter-spacing: 0.025em;
        }

        .room-list-item-badge i {
            font-size: 0.875rem;
        }

        .room-list-item-badge.classroom {
            background-color: rgba(59, 130, 246, 0.15);
            color: var(--primary);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .room-list-item-badge.restroom {
            background-color: rgba(6, 182, 212, 0.15);
            color: #0891b2;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .room-list-item-badge.emergency {
            background-color: rgba(16, 185, 129, 0.15);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .room-list-item-badge.special {
            background-color: rgba(168, 85, 247, 0.15);
            color: #9333ea;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .floor-plan {
            width: 100%;
            max-width: 100%;
            height: auto;
            max-height: 70vh;
            object-fit: contain;
        }

        .room-shape {
            fill: rgba(30, 36, 64, 0.7);
            stroke: rgba(165, 180, 252, 0.3);
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s;
        }

        .room-shape:hover {
            fill: rgba(124, 58, 237, 0.3);
            stroke: var(--primary-neon);
            stroke-width: 3;
            filter: drop-shadow(0 0 8px rgba(0, 240, 255, 0.6));
        }

        /* 트렌디한 방 색상 */
        .room-shape.classroom {
            fill: rgba(100, 116, 139, 0.4);
            stroke: rgba(148, 163, 184, 0.6);
        }
        .room-shape.admin {
            fill: rgba(249, 115, 22, 0.3);
            stroke: rgba(251, 146, 60, 0.7);
        }
        .room-shape.special {
            fill: rgba(168, 85, 247, 0.3);
            stroke: rgba(192, 132, 252, 0.7);
        }
        .room-shape.facility {
            fill: rgba(236, 72, 153, 0.3);
            stroke: rgba(244, 114, 182, 0.7);
        }
        .room-shape.emergency {
            fill: rgba(16, 185, 129, 0.3);
            stroke: rgba(52, 211, 153, 0.8);
        }
        .room-shape.restroom {
            fill: rgba(6, 182, 212, 0.3);
            stroke: rgba(34, 211, 238, 0.7);
        }

        .room-shape.highlight {
            fill: rgba(251, 191, 36, 0.4) !important;
            stroke: var(--warning) !important;
            stroke-width: 4 !important;
            animation: svgPulse 1.5s ease-in-out infinite;
            filter: drop-shadow(0 0 12px rgba(251, 191, 36, 0.8));
        }

        .room-group.selected .room-shape {
            fill: rgba(16, 185, 129, 0.4) !important;
            stroke: var(--success) !important;
            stroke-width: 4 !important;
            filter: drop-shadow(0 0 12px rgba(16, 185, 129, 0.8));
        }

        @keyframes svgPulse {
            0%, 100% {
                filter: drop-shadow(0 0 0 rgba(245, 158, 11, 0.4));
            }
            50% {
                filter: drop-shadow(0 0 12px rgba(245, 158, 11, 0.8));
            }
        }

        .room-label {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 14px;
            font-weight: 700;
            fill: var(--text-primary);
            pointer-events: none;
            user-select: none;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            paint-order: stroke fill;
            stroke: var(--bg-primary);
            stroke-width: 3px;
            stroke-linejoin: round;
            letter-spacing: 0.02em;
        }

        .room-sublabel {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 11px;
            font-weight: 600;
            fill: var(--text-secondary);
            pointer-events: none;
            user-select: none;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            paint-order: stroke fill;
            stroke: var(--bg-primary);
            stroke-width: 2.5px;
            stroke-linejoin: round;
            letter-spacing: 0.01em;
        }

        .waypoint {
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            fill: var(--primary-neon);
            opacity: 0.6;
        }

        .waypoint:hover {
            r: 8;
            opacity: 1;
            filter: drop-shadow(0 0 8px var(--primary-neon));
        }

        .corridor {
            fill: rgba(30, 36, 64, 0.4);
            stroke: rgba(165, 180, 252, 0.2);
            stroke-width: 1;
        }

        .stairs {
            fill: rgba(168, 85, 247, 0.3);
            stroke: rgba(192, 132, 252, 0.7);
            stroke-width: 2;
        }

        .elevator {
            fill: rgba(59, 130, 246, 0.3);
            stroke: rgba(96, 165, 250, 0.7);
            stroke-width: 2;
        }

        .view-toggle {
            display: none;
        }

        .view-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid #e2e8f0;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: var(--transition-base);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .view-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--bg-tertiary);
        }

        .view-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: #ffffff;
            font-weight: 700;
            box-shadow: var(--shadow-md);
        }

        /* Path Navigation */
        .path-navigation {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 2px solid #e4e7ec;
        }

        .path-inputs {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: nowrap;
        }

        .path-select {
            padding: 0.875rem;
            border: 2px solid #e4e7ec;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 200px;
        }

        .path-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .path-arrow {
            font-size: 1.5rem;
            color: #667eea;
        }

        .find-path-btn {
            padding: 0.875rem 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .find-path-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .find-path-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .path-info {
            display: none;
            padding: 1rem;
            background: #f0f9ff;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .path-info.show {
            display: block;
        }

        .path-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .path-info-label {
            color: #5b6b8e;
            font-weight: 500;
        }

        .path-info-value {
            color: #1a1f36;
            font-weight: 700;
        }

        .direction-arrow {
            fill: var(--warning);
            opacity: 0.9;
            animation: arrowPulse 1.5s ease-in-out infinite;
            transform-origin: center;
        }

        @keyframes arrowPulse {
            0%, 100% {
                opacity: 0.75;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        .turn-indicator {
            fill: none;
            stroke: var(--warning);
            stroke-width: 3;
            stroke-dasharray: 6, 4;
            opacity: 0.8;
        }

        .clear-path-btn {
            padding: 0.875rem 1.5rem;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .clear-path-btn:hover {
            background: #dc2626;
        }

        /* SVG Path Animation - Modern Style */
        .path-line {
            fill: none;
            stroke: var(--primary);
            stroke-width: 6;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 12 6;
            animation: pathDash 1s linear infinite;
            opacity: 0.9;
        }

        @keyframes pathDash {
            to {
                stroke-dashoffset: -18;
            }
        }

        .path-marker {
            fill: var(--primary);
            animation: pathPulse 1.5s ease-in-out infinite;
        }

        @keyframes pathPulse {
            0%, 100% {
                r: 6;
                opacity: 1;
            }
            50% {
                r: 8;
                opacity: 0.8;
            }
        }

        /* 경로 그리기 애니메이션 */
        @keyframes pathDraw {
            to {
                stroke-dashoffset: 0;
            }
        }

        /* 마커 펄스 애니메이션 */
        @keyframes markerPulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }

        .start-marker {
            fill: var(--success);
            animation: markerPulse 2s ease-in-out infinite;
        }

        .end-marker {
            fill: var(--error);
            animation: markerPulse 2s ease-in-out infinite;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 층간 이동 애니메이션 */
        .dual-floor-hidden {
            opacity: 0;
            transform: translateX(30px);
        }

        .dual-floor-fadein {
            animation: dualFloorFadeIn 0.5s ease-out forwards;
        }

        @keyframes dualFloorFadeIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .room-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .room-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #667eea;
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .room-card:hover {
            border-color: #667eea;
            background: white;
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }

        .room-card:hover::before {
            transform: scaleY(1);
        }

        .room-card.highlight {
            border-color: #f59e0b;
            background: #fffbeb;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .room-card.selected {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.3);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
            color: var(--text-primary);
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(245, 158, 11, 0);
            }
        }

        .room-number {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1a1f36;
            margin-bottom: 0.5rem;
        }

        .room-name {
            font-size: 0.9rem;
            color: #5b6b8e;
            margin-bottom: 0.5rem;
        }

        .room-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: #e0e7ff;
            color: #4f46e5;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .room-type.admin { background: #fce7f3; color: #be185d; }
        .room-type.special { background: #e0f2fe; color: #0369a1; }
        .room-type.facility { background: #d1fae5; color: #065f46; }
        .room-type.emergency { background: #fee2e2; color: #dc2626; }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            display: none;
        }

        .no-results.show {
            display: block;
        }

        .no-results-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .no-results h3 {
            font-size: 1.5rem;
            color: #5b6b8e;
            margin-bottom: 0.5rem;
        }

        .no-results p {
            color: #9ca3af;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #9ca3af;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #1a1f36;
        }

        .modal-body {
            color: #5b6b8e;
            line-height: 1.8;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 1rem 0;
            border-bottom: 1px solid #f0f2f5;
        }

        .info-label {
            font-weight: 600;
            color: #1a1f36;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            display: block;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #5b6b8e;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
            }

            .floor-selector {
                flex-direction: row;
                overflow-x: auto;
                padding-bottom: 1rem;
            }

            .floor-btn {
                min-width: 150px;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .map-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Spinner - Neon Style */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 39, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(165, 180, 252, 0.2);
            border-top: 4px solid var(--primary-neon);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.5);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notification - Neon Style */
        .toast-container {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            pointer-events: none;
        }

        .toast {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 1rem 1.5rem;
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 300px;
            max-width: 400px;
            pointer-events: all;
            animation: slideInRight 0.3s ease-out;
            border-left: 4px solid var(--primary-neon);
            border: 1px solid rgba(165, 180, 252, 0.3);
        }

        .toast.success {
            border-left-color: var(--success);
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
        }

        .toast.error {
            border-left-color: var(--error);
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.3);
        }

        .toast.warning {
            border-left-color: var(--warning);
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
        }

        .toast.info {
            border-left-color: var(--info);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }

        .toast-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            color: var(--success);
        }

        .toast.error .toast-icon {
            color: var(--error);
        }

        .toast.warning .toast-icon {
            color: var(--warning);
        }

        .toast.info .toast-icon {
            color: var(--info);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .toast-message {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 0.25rem;
            font-size: 1.25rem;
            transition: var(--transition-base);
        }

        .toast-close:hover {
            color: var(--text-primary);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* Legend - Hidden */
        .legend {
            display: none;
        }

        .legend-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-title i {
            color: var(--primary-500);
        }

        .legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: var(--transition-base);
        }

        .legend-item:hover {
            background: var(--gray-50);
        }

        .legend-color {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            border: 2px solid var(--gray-300);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .legend-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Quick Actions */
        .quick-actions {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 1000;
        }

        .quick-action-btn {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-full);
            background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
            color: white;
            border: none;
            box-shadow: var(--shadow-xl);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: var(--transition-base);
        }

        .quick-action-btn:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
        }

        .quick-action-btn:active {
            transform: scale(0.95);
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: var(--gray-900);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            white-space: nowrap;
            pointer-events: none;
            z-index: 10000;
            opacity: 0;
            transition: var(--transition-fast);
        }

        .tooltip.show {
            opacity: 1;
        }

        /* Improved Animations */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-5px);
            }
            75% {
                transform: translateX(5px);
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            transition: var(--transition-base);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-neon);
        }

        /* Focus Visible */
        *:focus-visible {
            outline: 2px solid var(--primary-neon);
            outline-offset: 2px;
        }

        /* Path Navigation - Hidden old one */
        .path-navigation {
            display: none;
        }

        /* Right Sidebar - Room List Panel */
        .rooms-sidebar {
            width: 320px;
            background: var(--bg-secondary);
            border-left: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .rooms-sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .rooms-sidebar-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .rooms-sidebar-subtitle {
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }

        .rooms-sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .rooms-sidebar .room-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .rooms-sidebar .room-list-item {
            background: var(--bg-primary);
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-md);
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
        }

        .rooms-sidebar .room-list-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleX(0);
            transition: var(--transition-base);
        }

        .rooms-sidebar .room-list-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateX(-2px);
        }

        .rooms-sidebar .room-list-item:hover::before {
            transform: scaleX(1);
        }

        .rooms-sidebar .room-list-item.selected {
            border-color: var(--primary);
            background: rgba(59, 130, 246, 0.05);
            box-shadow: var(--shadow-md);
        }

        .rooms-sidebar .room-list-item.selected::before {
            transform: scaleX(1);
        }

        .room-list-item-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .rooms-sidebar .room-list-item-id {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .rooms-sidebar .room-list-item-name {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .rooms-sidebar .room-list-item-badge {
            padding: 0.25rem 0.625rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .rooms-sidebar .room-list-item-badge.classroom {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
        }

        .rooms-sidebar .room-list-item-badge.special {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
        }

        .rooms-sidebar .room-list-item-badge.emergency {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .rooms-sidebar .room-list-item-badge.restroom {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        /* Responsive - Hide rooms sidebar on small screens */
        @media (max-width: 1200px) {
            .rooms-sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <header>
        <div class="header-content">
            <div class="header-text">
                <h1>
                    <i class="fas fa-school"></i>
                    서울고등학교 캠퍼스 안내
                </h1>
                <p class="subtitle">
                    <i class="fas fa-map-marked-alt"></i>
                    교실과 시설을 빠르게 찾아보세요
                </p>
            </div>
        </div>
    </header>

    <section class="search-section">
        <div class="search-container">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="searchInput" placeholder="교실, 특별실, 시설 이름을 검색하세요 (예: 1-1, 음악실, 도서관)">
                <button class="clear-btn" id="clearBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="filter-tags">
                <button class="floor-btn active" data-floor="4">
                    <i class="fas fa-layer-group"></i>
                    <span>4층</span>
                    <span class="room-count">19개</span>
                </button>
                <button class="floor-btn" data-floor="3">
                    <i class="fas fa-layer-group"></i>
                    <span>3층</span>
                    <span class="room-count">16개</span>
                </button>
                <button class="floor-btn" data-floor="2">
                    <i class="fas fa-layer-group"></i>
                    <span>2층</span>
                    <span class="room-count">16개</span>
                </button>
                <button class="floor-btn" data-floor="1">
                    <i class="fas fa-layer-group"></i>
                    <span>1층</span>
                    <span class="room-count">16개</span>
                </button>
            </div>
        </div>
    </section>

    <div class="main-content">
        <!-- Left Sidebar - Floor Tabs -->
        <div class="floor-sidebar">
            <button class="floor-btn active" data-floor="4">
                <i class="fas fa-layer-group"></i>
                <span>4F</span>
            </button>
            <button class="floor-btn" data-floor="3">
                <i class="fas fa-layer-group"></i>
                <span>3F</span>
            </button>
            <button class="floor-btn" data-floor="2">
                <i class="fas fa-layer-group"></i>
                <span>2F</span>
            </button>
            <button class="floor-btn" data-floor="1">
                <i class="fas fa-layer-group"></i>
                <span>1F</span>
            </button>
        </div>

        <main class="map-container">
            <div class="map-header">
                <h2 class="map-title">
                    <i class="fas fa-map"></i>
                    <span id="floorLabel">4층</span> 평면도
                </h2>

                <!-- Compact Path Controls -->
                <div class="path-controls">
                    <select class="path-select" id="startLocation">
                        <option value="">출발지</option>
                        <optgroup label="4층">
                            <option value="4-1">4-1</option>
                            <option value="4-2">4-2</option>
                            <option value="4-3">4-3</option>
                            <option value="4-4">4-4</option>
                            <option value="4-5">4-5</option>
                            <option value="4-6">4-6</option>
                            <option value="4-7">4-7</option>
                            <option value="4-8">4-8</option>
                            <option value="4-9">4-9</option>
                            <option value="4-10">4-10</option>
                            <option value="4-11">4-11</option>
                            <option value="4-12">4-12</option>
                            <option value="4-13">4-13</option>
                            <option value="4-14">4-14</option>
                            <option value="4-15">4-15</option>
                            <option value="4-16">4-16</option>
                            <option value="4-17">4-17</option>
                            <option value="4-18">4-18</option>
                            <option value="4-19">4-19</option>
                            <option value="비상구1">비상구1</option>
                            <option value="비상구2">비상구2</option>
                            <option value="비상구3">비상구3</option>
                        </optgroup>
                        <optgroup label="3층">
                            <option value="3-1">3-1</option>
                            <option value="3-2">3-2</option>
                            <option value="3-3">3-3</option>
                            <option value="3-4">3-4</option>
                            <option value="3-5">3-5</option>
                            <option value="3-7">3-7</option>
                            <option value="3-8">3-8</option>
                            <option value="3-9">3-9</option>
                            <option value="3-10">3-10</option>
                            <option value="3-11">3-11</option>
                            <option value="3-12">3-12</option>
                            <option value="3-13">3-13</option>
                            <option value="3-14">3-14</option>
                            <option value="3-15">3-15</option>
                            <option value="3-16">3-16</option>
                            <option value="3-17">3-17</option>
                            <option value="3-18">3-18</option>
                            <option value="3-19">3-19</option>
                            <option value="비상구1">비상구1</option>
                            <option value="비상구2">비상구2</option>
                            <option value="비상구3">비상구3</option>
                            <option value="비상구4">비상구4</option>
                        </optgroup>
                        <optgroup label="2층">
                            <option value="2-1">2-1</option>
                            <option value="2-2">2-2</option>
                            <option value="2-3">2-3</option>
                            <option value="2-4">2-4</option>
                            <option value="2-5">2-5</option>
                            <option value="2-7">2-7</option>
                            <option value="2-8">2-8</option>
                            <option value="2-10">2-10</option>
                            <option value="2-14">2-14</option>
                            <option value="2-15">2-15</option>
                            <option value="2-16">2-16</option>
                            <option value="2-17">2-17</option>
                            <option value="2-18">2-18</option>
                            <option value="2-19">2-19</option>
                            <option value="2-20">2-20</option>
                            <option value="비상구1">비상구1</option>
                            <option value="비상구2">비상구2</option>
                            <option value="비상구3">비상구3</option>
                            <option value="비상구4">비상구4</option>
                        </optgroup>
                        <optgroup label="1층">
                            <option value="1-1">1-1</option>
                            <option value="1-2">1-2</option>
                            <option value="1-3">1-3</option>
                            <option value="1-4">1-4</option>
                            <option value="1-5">1-5</option>
                            <option value="1-7">1-7</option>
                            <option value="1-8">1-8</option>
                            <option value="1-10">1-10</option>
                            <option value="1-14">1-14</option>
                            <option value="1-15">1-15</option>
                            <option value="1-16">1-16</option>
                            <option value="1-17">1-17</option>
                            <option value="1-18">1-18</option>
                            <option value="1-19">1-19</option>
                            <option value="1-20">1-20</option>
                            <option value="비상구1">비상구1</option>
                            <option value="비상구2">비상구2</option>
                            <option value="비상구3">비상구3</option>
                            <option value="비상구4">비상구4</option>
                            <option value="비상구5">비상구5</option>
                        </optgroup>
                    </select>

                    <i class="fas fa-arrow-right path-arrow"></i>

                    <select class="path-select" id="endLocation">
                        <option value="">목적지</option>
                        <optgroup label="4층">
                            <option value="4-1">4-1</option>
                            <option value="4-2">4-2</option>
                            <option value="4-3">4-3</option>
                            <option value="4-4">4-4</option>
                            <option value="4-5">4-5</option>
                            <option value="4-6">4-6</option>
                            <option value="4-7">4-7</option>
                            <option value="4-8">4-8</option>
                            <option value="4-9">4-9</option>
                            <option value="4-10">4-10</option>
                            <option value="4-11">4-11</option>
                            <option value="4-12">4-12</option>
                            <option value="4-13">4-13</option>
                            <option value="4-14">4-14</option>
                            <option value="4-15">4-15</option>
                            <option value="4-16">4-16</option>
                            <option value="4-17">4-17</option>
                            <option value="4-18">4-18</option>
                            <option value="4-19">4-19</option>
                            <option value="비상구1">비상구1</option>
                            <option value="비상구2">비상구2</option>
                            <option value="비상구3">비상구3</option>
                        </optgroup>
                        <optgroup label="3층">
                            <option value="3-1">3-1</option>
                            <option value="3-2">3-2</option>
                            <option value="3-3">3-3</option>
                            <option value="3-4">3-4</option>
                            <option value="3-5">3-5</option>
                            <option value="3-7">3-7</option>
                            <option value="3-8">3-8</option>
                            <option value="3-9">3-9</option>
                            <option value="3-10">3-10</option>
                            <option value="3-11">3-11</option>
                            <option value="3-12">3-12</option>
                            <option value="3-13">3-13</option>
                            <option value="3-14">3-14</option>
                            <option value="3-15">3-15</option>
                            <option value="3-16">3-16</option>
                            <option value="3-17">3-17</option>
                            <option value="3-18">3-18</option>
                            <option value="3-19">3-19</option>
                            <option value="비상구1">비상구1</option>
                            <option value="비상구2">비상구2</option>
                            <option value="비상구3">비상구3</option>
                            <option value="비상구4">비상구4</option>
                        </optgroup>
                        <optgroup label="2층">
                            <option value="2-1">2-1</option>
                            <option value="2-2">2-2</option>
                            <option value="2-3">2-3</option>
                            <option value="2-4">2-4</option>
                            <option value="2-5">2-5</option>
                            <option value="2-7">2-7</option>
                            <option value="2-8">2-8</option>
                            <option value="2-10">2-10</option>
                            <option value="2-14">2-14</option>
                            <option value="2-15">2-15</option>
                            <option value="2-16">2-16</option>
                            <option value="2-17">2-17</option>
                            <option value="2-18">2-18</option>
                            <option value="2-19">2-19</option>
                            <option value="2-20">2-20</option>
                            <option value="비상구1">비상구1</option>
                            <option value="비상구2">비상구2</option>
                            <option value="비상구3">비상구3</option>
                            <option value="비상구4">비상구4</option>
                        </optgroup>
                        <optgroup label="1층">
                            <option value="1-1">1-1</option>
                            <option value="1-2">1-2</option>
                            <option value="1-3">1-3</option>
                            <option value="1-4">1-4</option>
                            <option value="1-5">1-5</option>
                            <option value="1-7">1-7</option>
                            <option value="1-8">1-8</option>
                            <option value="1-10">1-10</option>
                            <option value="1-14">1-14</option>
                            <option value="1-15">1-15</option>
                            <option value="1-16">1-16</option>
                            <option value="1-17">1-17</option>
                            <option value="1-18">1-18</option>
                            <option value="1-19">1-19</option>
                            <option value="1-20">1-20</option>
                            <option value="비상구1">비상구1</option>
                            <option value="비상구2">비상구2</option>
                            <option value="비상구3">비상구3</option>
                            <option value="비상구4">비상구4</option>
                            <option value="비상구5">비상구5</option>
                        </optgroup>
                    </select>

                    <button class="path-btn" id="findPathBtn">
                        <i class="fas fa-route"></i>
                        길찾기
                    </button>
                    <button class="path-btn path-btn-secondary" id="clearPathBtn">
                        <i class="fas fa-eraser"></i>
                        초기화
                    </button>
                </div>

                <div class="map-controls">
                    <button class="control-btn" id="resetBtn" title="경로 초기화">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="control-btn" title="인쇄">
                        <i class="fas fa-print"></i>
                    </button>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-title">
                    <i class="fas fa-info-circle"></i>
                    범례
                </div>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #C0C0C0;">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <span class="legend-label">일반 교실</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FFA500;">
                            <i class="fas fa-door-open"></i>
                        </div>
                        <span class="legend-label">특별실/시설</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00BFFF;">
                            <i class="fas fa-restroom"></i>
                        </div>
                        <span class="legend-label">화장실</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00FF00;">
                            <i class="fas fa-first-aid"></i>
                        </div>
                        <span class="legend-label">비상구/안전</span>
                    </div>
                </div>
            </div>

            <div class="view-toggle">
                <button class="view-btn active" data-view="plan">
                    <i class="fas fa-map"></i>
                    평면도 보기
                </button>
                <button class="view-btn" data-view="list">
                    <i class="fas fa-list"></i>
                    목록 보기
                </button>
                <button class="view-btn" data-view="image">
                    <i class="fas fa-image"></i>
                    실제 이미지 보기
                </button>
            </div>

            <!-- Path Navigation -->
            <div class="path-navigation">
                <div class="path-inputs">
                    <select class="path-select" id="startLocation">
                        <option value="">🚩 출발지 선택</option>
                        <optgroup label="4층">
                            <option value="4-1">4층 - 4-1</option>
                            <option value="4-2">4층 - 4-2</option>
                            <option value="4-3">4층 - 4-3</option>
                            <option value="4-4">4층 - 4-4</option>
                            <option value="4-5">4층 - 4-5</option>
                            <option value="4-6">4층 - 4-6</option>
                            <option value="4-7">4층 - 4-7</option>
                            <option value="4-8">4층 - 4-8</option>
                            <option value="4-9">4층 - 4-9</option>
                            <option value="4-10">4층 - 4-10</option>
                            <option value="4-11">4층 - 4-11</option>
                            <option value="4-12">4층 - 4-12</option>
                            <option value="4-13">4층 - 4-13</option>
                            <option value="4-14">4층 - 4-14</option>
                            <option value="4-15">4층 - 4-15</option>
                            <option value="4-16">4층 - 4-16</option>
                            <option value="4-17">4층 - 4-17</option>
                            <option value="4-18">4층 - 4-18</option>
                            <option value="4-19">4층 - 4-19</option>
                            <option value="비상구1">4층 - 비상구1</option>
                            <option value="비상구2">4층 - 비상구2</option>
                            <option value="비상구3">4층 - 비상구3</option>
                        </optgroup>
                        <optgroup label="3층">
                            <option value="3-1">3층 - 3-1</option>
                            <option value="3-2">3층 - 3-2</option>
                            <option value="3-3">3층 - 3-3</option>
                            <option value="3-4">3층 - 3-4</option>
                            <option value="3-5">3층 - 3-5</option>
                            <option value="3-7">3층 - 3-7</option>
                            <option value="3-8">3층 - 3-8</option>
                            <option value="3-9">3층 - 3-9</option>
                            <option value="3-10">3층 - 3-10</option>
                            <option value="3-11">3층 - 3-11</option>
                            <option value="3-12">3층 - 3-12</option>
                            <option value="3-13">3층 - 3-13</option>
                            <option value="3-14">3층 - 3-14</option>
                            <option value="3-15">3층 - 3-15</option>
                            <option value="3-16">3층 - 3-16</option>
                            <option value="3-17">3층 - 3-17</option>
                            <option value="3-18">3층 - 3-18</option>
                            <option value="3-19">3층 - 3-19</option>
                            <option value="비상구1">3층 - 비상구1</option>
                            <option value="비상구2">3층 - 비상구2</option>
                            <option value="비상구3">3층 - 비상구3</option>
                            <option value="비상구4">3층 - 비상구4</option>
                        </optgroup>
                        <optgroup label="2층">
                            <option value="2-1">2층 - 2-1</option>
                            <option value="2-2">2층 - 2-2</option>
                            <option value="2-3">2층 - 2-3</option>
                            <option value="2-4">2층 - 2-4</option>
                            <option value="2-5">2층 - 2-5</option>
                            <option value="2-7">2층 - 2-7</option>
                            <option value="2-8">2층 - 2-8</option>
                            <option value="2-10">2층 - 2-10</option>
                            <option value="2-14">2층 - 2-14</option>
                            <option value="2-15">2층 - 2-15</option>
                            <option value="2-16">2층 - 2-16</option>
                            <option value="2-17">2층 - 2-17</option>
                            <option value="2-18">2층 - 2-18</option>
                            <option value="2-19">2층 - 2-19</option>
                            <option value="2-20">2층 - 2-20</option>
                            <option value="비상구1">2층 - 비상구1</option>
                            <option value="비상구2">2층 - 비상구2</option>
                            <option value="비상구3">2층 - 비상구3</option>
                            <option value="비상구4">2층 - 비상구4</option>
                        </optgroup>
                        <optgroup label="1층">
                            <option value="1-1">1층 - 1-1</option>
                            <option value="1-2">1층 - 1-2</option>
                            <option value="1-3">1층 - 1-3</option>
                            <option value="1-4">1층 - 1-4</option>
                            <option value="1-5">1층 - 1-5</option>
                            <option value="1-7">1층 - 1-7</option>
                            <option value="1-8">1층 - 1-8</option>
                            <option value="1-10">1층 - 1-10</option>
                            <option value="1-14">1층 - 1-14</option>
                            <option value="1-15">1층 - 1-15</option>
                            <option value="1-16">1층 - 1-16</option>
                            <option value="1-17">1층 - 1-17</option>
                            <option value="1-18">1층 - 1-18</option>
                            <option value="1-19">1층 - 1-19</option>
                            <option value="1-20">1층 - 1-20</option>
                            <option value="비상구1">1층 - 비상구1</option>
                            <option value="비상구2">1층 - 비상구2</option>
                            <option value="비상구3">1층 - 비상구3</option>
                            <option value="비상구4">1층 - 비상구4</option>
                            <option value="비상구5">1층 - 비상구5</option>
                        </optgroup>
                    </select>
                    <span class="path-arrow">→</span>
                    <select class="path-select" id="endLocation">
                        <option value="">🎯 목적지 선택</option>
                        <optgroup label="4층">
                            <option value="4-1">4층 - 4-1</option>
                            <option value="4-2">4층 - 4-2</option>
                            <option value="4-3">4층 - 4-3</option>
                            <option value="4-4">4층 - 4-4</option>
                            <option value="4-5">4층 - 4-5</option>
                            <option value="4-6">4층 - 4-6</option>
                            <option value="4-7">4층 - 4-7</option>
                            <option value="4-8">4층 - 4-8</option>
                            <option value="4-9">4층 - 4-9</option>
                            <option value="4-10">4층 - 4-10</option>
                            <option value="4-11">4층 - 4-11</option>
                            <option value="4-12">4층 - 4-12</option>
                            <option value="4-13">4층 - 4-13</option>
                            <option value="4-14">4층 - 4-14</option>
                            <option value="4-15">4층 - 4-15</option>
                            <option value="4-16">4층 - 4-16</option>
                            <option value="4-17">4층 - 4-17</option>
                            <option value="4-18">4층 - 4-18</option>
                            <option value="4-19">4층 - 4-19</option>
                            <option value="비상구1">4층 - 비상구1</option>
                            <option value="비상구2">4층 - 비상구2</option>
                            <option value="비상구3">4층 - 비상구3</option>
                        </optgroup>
                        <optgroup label="3층">
                            <option value="3-1">3층 - 3-1</option>
                            <option value="3-2">3층 - 3-2</option>
                            <option value="3-3">3층 - 3-3</option>
                            <option value="3-4">3층 - 3-4</option>
                            <option value="3-5">3층 - 3-5</option>
                            <option value="3-7">3층 - 3-7</option>
                            <option value="3-8">3층 - 3-8</option>
                            <option value="3-9">3층 - 3-9</option>
                            <option value="3-10">3층 - 3-10</option>
                            <option value="3-11">3층 - 3-11</option>
                            <option value="3-12">3층 - 3-12</option>
                            <option value="3-13">3층 - 3-13</option>
                            <option value="3-14">3층 - 3-14</option>
                            <option value="3-15">3층 - 3-15</option>
                            <option value="3-16">3층 - 3-16</option>
                            <option value="3-17">3층 - 3-17</option>
                            <option value="3-18">3층 - 3-18</option>
                            <option value="3-19">3층 - 3-19</option>
                            <option value="비상구1">3층 - 비상구1</option>
                            <option value="비상구2">3층 - 비상구2</option>
                            <option value="비상구3">3층 - 비상구3</option>
                            <option value="비상구4">3층 - 비상구4</option>
                        </optgroup>
                        <optgroup label="2층">
                            <option value="2-1">2층 - 2-1</option>
                            <option value="2-2">2층 - 2-2</option>
                            <option value="2-3">2층 - 2-3</option>
                            <option value="2-4">2층 - 2-4</option>
                            <option value="2-5">2층 - 2-5</option>
                            <option value="2-7">2층 - 2-7</option>
                            <option value="2-8">2층 - 2-8</option>
                            <option value="2-10">2층 - 2-10</option>
                            <option value="2-14">2층 - 2-14</option>
                            <option value="2-15">2층 - 2-15</option>
                            <option value="2-16">2층 - 2-16</option>
                            <option value="2-17">2층 - 2-17</option>
                            <option value="2-18">2층 - 2-18</option>
                            <option value="2-19">2층 - 2-19</option>
                            <option value="2-20">2층 - 2-20</option>
                            <option value="비상구1">2층 - 비상구1</option>
                            <option value="비상구2">2층 - 비상구2</option>
                            <option value="비상구3">2층 - 비상구3</option>
                            <option value="비상구4">2층 - 비상구4</option>
                        </optgroup>
                        <optgroup label="1층">
                            <option value="1-1">1층 - 1-1</option>
                            <option value="1-2">1층 - 1-2</option>
                            <option value="1-3">1층 - 1-3</option>
                            <option value="1-4">1층 - 1-4</option>
                            <option value="1-5">1층 - 1-5</option>
                            <option value="1-7">1층 - 1-7</option>
                            <option value="1-8">1층 - 1-8</option>
                            <option value="1-10">1층 - 1-10</option>
                            <option value="1-14">1층 - 1-14</option>
                            <option value="1-15">1층 - 1-15</option>
                            <option value="1-16">1층 - 1-16</option>
                            <option value="1-17">1층 - 1-17</option>
                            <option value="1-18">1층 - 1-18</option>
                            <option value="1-19">1층 - 1-19</option>
                            <option value="1-20">1층 - 1-20</option>
                            <option value="비상구1">1층 - 비상구1</option>
                            <option value="비상구2">1층 - 비상구2</option>
                            <option value="비상구3">1층 - 비상구3</option>
                            <option value="비상구4">1층 - 비상구4</option>
                            <option value="비상구5">1층 - 비상구5</option>
                        </optgroup>
                    </select>
                    <button class="find-path-btn" id="findPathBtn">🧭 길찾기</button>
                    <button class="clear-path-btn" id="clearPathBtn">경로 지우기</button>
                </div>
            </div>

            <!-- 4층 -->
            <div class="floor-map active" data-floor="4">
                <!-- Real Image View -->
                <div class="floor-image-container" data-view-type="image" style="display: none;">
                    <img src="4층_수정2.PNG" alt="4층 실제 도면" class="floor-image">
                </div>

                <!-- List View -->
                <div class="floor-list-container" data-view-type="list" style="display: none;">
                    <div class="room-list" id="room-list-4"></div>
                </div>

                <!-- SVG Floor Plan -->
                <div class="floor-plan-container" data-view-type="plan">
                    <svg class="floor-plan" viewBox="0 0 1000 800" xmlns="http://www.w3.org/2000/svg">
                        <!-- Background -->
                        <rect width="1000" height="800" fill="#f5f5f5"/>

                        <!-- 복도 벽 (4층_복도표시2.png 기준) -->
                        <g class="corridor-walls">
                            <!-- 대각선 복도 (4-10 바닥 오른쪽 모서리 → 4-14 위쪽 오른쪽 모서리 방향, 4-16 바닥선과 만나는 지점에서 멈춤) -->
                            <line x1="495" y1="520" x2="631" y2="605" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 가로선 (4-16 바닥 높이에서 대각선 교차점까지) -->
                            <line x1="792" y1="605" x2="631" y2="605" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 가로선 (비상구2 바닥에서 왼쪽으로, 비상구1 오른쪽과 만나는 지점까지) -->
                            <line x1="365" y1="515" x2="212" y2="515" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 세로선 (비상구1 오른쪽 바닥에서 아래로, 비상구2 바닥선과 만나는 지점까지) -->
                            <line x1="212" y1="235" x2="212" y2="515" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 중간 세로선 (비상구4 벽 아래에서 4-17 위까지) -->
                            <line x1="820" y1="235" x2="820" y2="400" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 오른쪽 세로선 (비상구4 위치(막힌 벽)부터 4-17, 4-18, 4-19 왼쪽 → 비상구3까지) -->
                            <line x1="875" y1="235" x2="875" y2="810" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>
                        </g>

                        <!-- 왼쪽 세로 7개 방 - 균일한 간격으로 재배치 -->
                        <g class="room-group" data-room="비상구1" data-type="emergency">
                            <rect class="room-shape emergency" x="160" y="183" width="52" height="52" rx="5"/>
                            <text class="room-label" x="186" y="214" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <g class="room-group" data-room="4-1" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="243" width="52" height="52" rx="5"/>
                            <text class="room-label" x="131" y="274" text-anchor="middle">4-1</text>
                        </g>

                        <g class="room-group" data-room="4-2" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="303" width="52" height="52" rx="5"/>
                            <text class="room-label" x="131" y="334" text-anchor="middle">4-2</text>
                        </g>

                        <g class="room-group" data-room="4-3" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="363" width="52" height="52" rx="5"/>
                            <text class="room-label" x="131" y="394" text-anchor="middle">4-3</text>
                        </g>

                        <g class="room-group" data-room="4-4" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="423" width="52" height="52" rx="5"/>
                            <text class="room-label" x="131" y="454" text-anchor="middle">4-4</text>
                        </g>

                        <g class="room-group" data-room="4-5" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="483" width="52" height="52" rx="5"/>
                            <text class="room-label" x="131" y="514" text-anchor="middle">4-5</text>
                        </g>

                        <g class="room-group" data-room="4-6" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="543" width="52" height="52" rx="5"/>
                            <text class="room-label" x="131" y="574" text-anchor="middle">4-6</text>
                        </g>

                        <!-- 왼쪽 하단 3개 가로 방 -->
                        <g class="room-group" data-room="4-7" data-type="facility">
                            <rect class="room-shape facility" x="210" y="595" width="55" height="50" rx="5"/>
                            <text class="room-label" x="237" y="625" text-anchor="middle" font-size="11">4-7</text>
                        </g>

                        <g class="room-group" data-room="4-8" data-type="facility">
                            <rect class="room-shape facility" x="285" y="595" width="60" height="50" rx="5"/>
                            <text class="room-label" x="315" y="625" text-anchor="middle" font-size="11">4-8</text>
                        </g>

                        <g class="room-group" data-room="4-9" data-type="facility">
                            <rect class="room-shape facility" x="365" y="595" width="60" height="50" rx="5"/>
                            <text class="room-label" x="395" y="625" text-anchor="middle" font-size="11">4-9</text>
                        </g>

                        <!-- 중앙 2개 방 -->
                        <g class="room-group" data-room="비상구2" data-type="emergency">
                            <rect class="room-shape emergency" x="365" y="455" width="60" height="60" rx="5"/>
                            <text class="room-label" x="395" y="490" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <g class="room-group" data-room="4-10" data-type="admin">
                            <rect class="room-shape admin" x="435" y="455" width="60" height="65" rx="5"/>
                            <text class="room-label" x="465" y="493" text-anchor="middle" font-size="11">4-10</text>
                        </g>

                        <!-- 중앙 하단 1개 방 -->
                        <g class="room-group" data-room="4-11" data-type="classroom">
                            <rect class="room-shape classroom" x="435" y="625" width="65" height="65" rx="5"/>
                            <text class="room-label" x="467" y="662" text-anchor="middle">4-11</text>
                        </g>

                        <!-- 하단 5개 가로 방 -->
                        <g class="room-group" data-room="4-12" data-type="classroom">
                            <rect class="room-shape classroom" x="500" y="650" width="60" height="55" rx="5"/>
                            <text class="room-label" x="530" y="682" text-anchor="middle">4-12</text>
                        </g>

                        <g class="room-group" data-room="4-13" data-type="classroom">
                            <rect class="room-shape classroom" x="560" y="680" width="60" height="55" rx="5"/>
                            <text class="room-label" x="590" y="712" text-anchor="middle">4-13</text>
                        </g>

                        <g class="room-group" data-room="4-14" data-type="classroom">
                            <rect class="room-shape classroom" x="635" y="680" width="60" height="55" rx="5"/>
                            <text class="room-label" x="665" y="712" text-anchor="middle">4-14</text>
                        </g>

                        <g class="room-group" data-room="4-15" data-type="classroom">
                            <rect class="room-shape classroom" x="695" y="680" width="55" height="55" rx="5"/>
                            <text class="room-label" x="722" y="712" text-anchor="middle">4-15</text>
                        </g>

                        <g class="room-group" data-room="4-16" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="680" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="712" text-anchor="middle">4-16</text>
                        </g>

                        <g class="room-group" data-room="비상구3" data-type="emergency">
                            <rect class="room-shape emergency" x="820" y="735" width="55" height="60" rx="5"/>
                            <text class="room-label" x="847" y="770" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <!-- 오른쪽 세로 3개 방 -->
                        <g class="room-group" data-room="4-17" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="400" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="432" text-anchor="middle">4-17</text>
                        </g>

                        <g class="room-group" data-room="4-18" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="475" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="507" text-anchor="middle">4-18</text>
                        </g>

                        <g class="room-group" data-room="4-19" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="550" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="582" text-anchor="middle">4-19</text>
                        </g>

                        <!-- 4층 비상구4 위치에 벽 추가 (막힌 공간) -->
                        <rect x="820" y="183" width="55" height="52" fill="#9ca3af" opacity="0.4" rx="5"/>
                        <rect x="820" y="183" width="55" height="52" fill="none" stroke="#6b7280" stroke-width="2" rx="5"/>
                        <text x="847" y="214" text-anchor="middle" font-size="10" fill="#6b7280">벽</text>

                        <!-- Waypoints (붉은 점) - 이미지 원본 위치 기준 + 세분화된 중간 점들 -->
                        <!-- 4층에는 비상구4 없음 - w60은 4-17의 가장 가까운 웨이포인트 -->
                        <!-- 왼쪽 세로 방들 (비상구1 아래 복도) -->
                        <circle class="waypoint" cx="170" cy="240" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w1"/>

                        <!-- 왼쪽 세로 방들 (4-1 ~ 4-6) - 더 촘촘하게 세분화 -->
                        <circle class="waypoint" cx="170" cy="269" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w2"/>
                        <circle class="waypoint" cx="170" cy="299" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w3"/>
                        <circle class="waypoint" cx="170" cy="329" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w4"/>
                        <circle class="waypoint" cx="170" cy="359" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w5"/>
                        <circle class="waypoint" cx="170" cy="389" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w6"/>
                        <circle class="waypoint" cx="170" cy="419" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w7"/>
                        <circle class="waypoint" cx="170" cy="449" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w8"/>
                        <circle class="waypoint" cx="170" cy="479" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w9"/>
                        <circle class="waypoint" cx="170" cy="509" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w10"/>
                        <circle class="waypoint" cx="170" cy="539" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w11"/>
                        <circle class="waypoint" cx="170" cy="569" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w12"/>
                        <circle class="waypoint" cx="170" cy="399" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w13"/>
                        <circle class="waypoint" cx="170" cy="418" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w14"/>
                        <circle class="waypoint" cx="170" cy="436" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w15"/>
                        <circle class="waypoint" cx="170" cy="455" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w16"/>
                        <circle class="waypoint" cx="170" cy="474" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w17"/>
                        <circle class="waypoint" cx="170" cy="493" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w18"/>
                        <circle class="waypoint" cx="170" cy="511" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w19"/>
                        <circle class="waypoint" cx="170" cy="530" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w20"/>
                        <circle class="waypoint" cx="170" cy="549" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w21"/>
                        <circle class="waypoint" cx="170" cy="568" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w22"/>

                        <!-- 왼쪽 하단 가로 복도 - 세분화 -->
                        <circle class="waypoint" cx="230" cy="570" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w23"/>
                        <circle class="waypoint" cx="248" cy="568" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w24"/>
                        <circle class="waypoint" cx="267" cy="567" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w25"/>
                        <circle class="waypoint" cx="286" cy="566" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w26"/>
                        <circle class="waypoint" cx="305" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w27"/>
                        <circle class="waypoint" cx="323" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w28"/>
                        <circle class="waypoint" cx="342" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w29"/>
                        <circle class="waypoint" cx="361" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w30"/>
                        <circle class="waypoint" cx="380" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w31"/>

                        <!-- 회의실/상담실 아래 연결 -->
                        <circle class="waypoint" cx="395" cy="515" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w32"/>
                        <circle class="waypoint" cx="410" cy="530" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w33"/>
                        <circle class="waypoint" cx="430" cy="545" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w34"/>
                        <circle class="waypoint" cx="465" cy="530" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w35"/>
                        <circle class="waypoint" cx="480" cy="545" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w36"/>

                        <!-- 4-11 위쪽 중간 웨이포인트 -->
                        <circle class="waypoint" cx="467" cy="600" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w36a"/>

                        <!-- 중앙 하단에서 하단 가로 복도로 연결 -->
                        <circle class="waypoint" cx="480" cy="580" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w37"/>
                        <circle class="waypoint" cx="490" cy="592" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w38"/>

                        <!-- 하단 가로 방들 - 세분화 -->
                        <circle class="waypoint" cx="525" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w39"/>
                        <circle class="waypoint" cx="541" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w40"/>
                        <circle class="waypoint" cx="557" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w41"/>
                        <circle class="waypoint" cx="573" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w42"/>
                        <circle class="waypoint" cx="590" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w43"/>
                        <circle class="waypoint" cx="607" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w44"/>
                        <circle class="waypoint" cx="625" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w45"/>
                        <circle class="waypoint" cx="642" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w46"/>
                        <circle class="waypoint" cx="660" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w47"/>
                        <circle class="waypoint" cx="677" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w48"/>
                        <circle class="waypoint" cx="695" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w49"/>
                        <circle class="waypoint" cx="712" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w50"/>
                        <circle class="waypoint" cx="730" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w51"/>
                        <circle class="waypoint" cx="747" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w52"/>
                        <circle class="waypoint" cx="765" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w53"/>
                        <circle class="waypoint" cx="782" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w54"/>
                        <circle class="waypoint" cx="800" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w55"/>
                        <circle class="waypoint" cx="825" cy="663" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w56"/>
                        <circle class="waypoint" cx="850" cy="677" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w57"/>
                        <circle class="waypoint" cx="875" cy="691" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w58"/>
                        <circle class="waypoint" cx="847" cy="735" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w76"/>

                        <!-- 오른쪽 세로 방들 - 세분화 -->
                        <circle class="waypoint" cx="830" cy="427" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w60"/>
                        <circle class="waypoint" cx="830" cy="445" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w61"/>
                        <circle class="waypoint" cx="830" cy="464" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w62"/>
                        <circle class="waypoint" cx="830" cy="483" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w63"/>
                        <circle class="waypoint" cx="830" cy="502" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w64"/>
                        <circle class="waypoint" cx="830" cy="520" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w65"/>
                        <circle class="waypoint" cx="830" cy="539" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w66"/>
                        <circle class="waypoint" cx="830" cy="558" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w67"/>
                        <circle class="waypoint" cx="830" cy="577" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w68"/>
                        <circle class="waypoint" cx="830" cy="615" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w70"/>
                        <circle class="waypoint" cx="835" cy="655" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w72"/>
                        <circle class="waypoint" cx="847" cy="735" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w76"/>

                        <!-- 비상구4에서 오른쪽 복도로 연결 -->
                        <circle class="waypoint" cx="830" cy="250" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w78"/>
                        <circle class="waypoint" cx="830" cy="300" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w79"/>
                        <circle class="waypoint" cx="830" cy="337" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w79a"/>
                        <circle class="waypoint" cx="830" cy="350" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w80"/>
                        <circle class="waypoint" cx="830" cy="390" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w81"/>

                        <!-- Waypoint connections (통로 선) -->
                        <g id="waypointPaths" stroke="#e0e0e0" stroke-width="2" fill="none" opacity="0.5">
                            <!-- 왼쪽 세로 연결 -->
                            <line x1="185" y1="110" x2="170" y2="155" data-path="w1-w2"/>
                            <line x1="170" y1="155" x2="170" y2="230" data-path="w2-w3"/>
                            <line x1="170" y1="230" x2="170" y2="305" data-path="w3-w4"/>
                            <line x1="170" y1="305" x2="170" y2="380" data-path="w4-w5"/>
                            <line x1="170" y1="380" x2="170" y2="455" data-path="w5-w6"/>
                            <line x1="170" y1="455" x2="170" y2="530" data-path="w6-w7"/>

                            <!-- 왼쪽 하단 연결 -->
                            <line x1="170" y1="530" x2="230" y2="570" data-path="w7-w8"/>
                            <line x1="230" y1="570" x2="305" y2="565" data-path="w8-w9"/>
                            <line x1="305" y1="565" x2="380" y2="565" data-path="w9-w10"/>

                            <!-- 중앙 연결 -->
                            <line x1="380" y1="565" x2="385" y2="525" data-path="w10-w11"/>
                            <line x1="385" y1="525" x2="455" y2="525" data-path="w11-w12"/>

                            <!-- 중앙에서 하단으로 -->
                            <line x1="455" y1="525" x2="460" y2="605" data-path="w12-w13"/>
                            <line x1="460" y1="605" x2="525" y2="650" data-path="w13-w14"/>
                            <line x1="525" y1="650" x2="590" y2="650" data-path="w14-w15"/>
                            <line x1="590" y1="650" x2="660" y2="650" data-path="w15-w16"/>
                            <line x1="660" y1="650" x2="730" y2="650" data-path="w16-w17"/>
                            <line x1="730" y1="650" x2="800" y2="650" data-path="w17-w18"/>
                            <line x1="800" y1="650" x2="835" y2="655" data-path="w18-w72"/>
                            <line x1="835" y1="655" x2="847" y2="735" data-path="w72-w76"/>

                            <!-- 오른쪽 연결 -->
                            <line x1="847" y1="735" x2="835" y2="655" data-path="w76-w72"/>
                            <line x1="835" y1="655" x2="830" y2="615" data-path="w72-w70"/>
                            <line x1="830" y1="615" x2="830" y2="577" data-path="w70-w68"/>

                            <!-- 오른쪽 세로 연결 -->
                            <line x1="830" y1="577" x2="830" y2="502" data-path="w68-w64"/>
                            <line x1="830" y1="502" x2="830" y2="427" data-path="w64-w60"/>

                        </g>

                        <!-- Path Layer (for animated navigation) -->
                        <g id="pathLayer">
                            <!-- Dynamic path will be drawn here -->
                        </g>

                        <defs>
                            <marker id="arrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
                                <polygon points="0 0, 6 2, 0 4" fill="#667eea" />
                            </marker>
                        </defs>
                    </svg>
                </div>

                <!-- List View -->
                <div class="map-grid" data-view-type="list" style="display: none;">
                    <div class="room-card" data-room="3-1" data-type="classroom">
                        <div class="room-number">3-1</div>
                        <div class="room-name">3학년 1반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="3-2" data-type="classroom">
                        <div class="room-number">3-2</div>
                        <div class="room-name">3학년 2반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="3-3" data-type="classroom">
                        <div class="room-number">3-3</div>
                        <div class="room-name">3학년 3반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="3-4" data-type="classroom">
                        <div class="room-number">3-4</div>
                        <div class="room-name">3학년 4반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="3-5" data-type="classroom">
                        <div class="room-number">3-5</div>
                        <div class="room-name">3학년 5반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">음악실 1</div>
                        <div class="room-name">밴드 연습실</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">음악실 2</div>
                        <div class="room-name">합창 연습실</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">미술실</div>
                        <div class="room-name">미술 수업 전용</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="admin">
                        <div class="room-number">3학년부</div>
                        <div class="room-name">3학년 교무실</div>
                        <span class="room-type admin">행정실</span>
                    </div>
                    <div class="room-card" data-type="facility">
                        <div class="room-number">화장실</div>
                        <div class="room-name">남/여 화장실</div>
                        <span class="room-type facility">편의시설</span>
                    </div>
                    <div class="room-card" data-type="facility">
                        <div class="room-number">휴게실</div>
                        <div class="room-name">학생 휴게 공간</div>
                        <span class="room-type facility">편의시설</span>
                    </div>
                </div>
            </div>

            <!-- 3층 -->
            <div class="floor-map" data-floor="3">
                <!-- Real Image View -->
                <div class="floor-image-container" data-view-type="image" style="display: none;">
                    <img src="3층.PNG" alt="3층 실제 도면" class="floor-image">
                </div>

                <!-- List View -->
                <div class="floor-list-container" data-view-type="list" style="display: none;">
                    <div class="room-list" id="room-list-3"></div>
                </div>

                <!-- SVG Floor Plan -->
                <div class="floor-plan-container" data-view-type="plan">
                    <svg class="floor-plan" viewBox="0 0 1000 800" xmlns="http://www.w3.org/2000/svg">
                        <!-- Background -->
                        <rect width="1000" height="800" fill="#f5f5f5"/>

                        <!-- 복도 벽 (4층_복도표시2.png 기준) -->
                        <g class="corridor-walls">
                            <!-- 대각선 복도 (4-10 바닥 오른쪽 모서리 → 4-14 위쪽 오른쪽 모서리 방향, 4-16 바닥선과 만나는 지점에서 멈춤) -->
                            <line x1="495" y1="520" x2="631" y2="605" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 가로선 (4-16 바닥 높이에서 대각선 교차점까지) -->
                            <line x1="792" y1="605" x2="631" y2="605" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 가로선 (비상구2 바닥에서 왼쪽으로, 비상구1 오른쪽과 만나는 지점까지) -->
                            <line x1="365" y1="515" x2="212" y2="515" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 세로선 (비상구1 오른쪽 바닥에서 아래로) -->
                            <line x1="212" y1="235" x2="212" y2="515" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 중간 세로선 (비상구4 왼쪽에서 3-17 오른쪽까지) -->
                            <line x1="820" y1="235" x2="820" y2="400" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 오른쪽 세로선 (비상구4 아래 → 3-17, 3-18, 3-19 왼쪽 → 비상구3까지) -->
                            <line x1="875" y1="235" x2="875" y2="810" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>
                        </g>

                        <!-- 왼쪽 세로 방들 -->
                        <g class="room-group" data-room="비상구1" data-type="emergency">
                            <rect class="room-shape emergency" x="160" y="183" width="52" height="52" rx="5"/>
                            <text class="room-label" x="186" y="214" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <g class="room-group" data-room="3-1" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="243" width="52" height="70" rx="5"/>
                            <text class="room-label" x="131" y="283" text-anchor="middle">3-1</text>
                        </g>

                        <g class="room-group" data-room="3-2" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="313" width="52" height="70" rx="5"/>
                            <text class="room-label" x="131" y="353" text-anchor="middle">3-2</text>
                        </g>

                        <g class="room-group" data-room="3-3" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="383" width="52" height="71" rx="5"/>
                            <text class="room-label" x="131" y="423" text-anchor="middle">3-3</text>
                        </g>

                        <g class="room-group" data-room="3-4" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="454" width="52" height="71" rx="5"/>
                            <text class="room-label" x="131" y="494" text-anchor="middle">3-4</text>
                        </g>

                        <g class="room-group" data-room="3-5" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="525" width="52" height="70" rx="5"/>
                            <text class="room-label" x="131" y="565" text-anchor="middle">3-5</text>
                        </g>

                        <!-- 왼쪽 하단 3개 가로 방 -->
                        <g class="room-group" data-room="3-7" data-type="facility">
                            <rect class="room-shape facility" x="210" y="595" width="55" height="50" rx="5"/>
                            <text class="room-label" x="237" y="625" text-anchor="middle" font-size="11">3-7</text>
                        </g>

                        <g class="room-group" data-room="3-8" data-type="facility">
                            <rect class="room-shape facility" x="285" y="595" width="60" height="50" rx="5"/>
                            <text class="room-label" x="315" y="625" text-anchor="middle" font-size="11">3-8</text>
                        </g>

                        <g class="room-group" data-room="3-9" data-type="facility">
                            <rect class="room-shape facility" x="365" y="595" width="60" height="50" rx="5"/>
                            <text class="room-label" x="395" y="625" text-anchor="middle" font-size="11">3-9</text>
                        </g>

                        <!-- 중앙 2개 방 -->
                        <g class="room-group" data-room="비상구2" data-type="emergency">
                            <rect class="room-shape emergency" x="365" y="455" width="60" height="60" rx="5"/>
                            <text class="room-label" x="395" y="490" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <g class="room-group" data-room="3-10" data-type="admin">
                            <rect class="room-shape admin" x="435" y="455" width="60" height="65" rx="5"/>
                            <text class="room-label" x="465" y="493" text-anchor="middle" font-size="11">3-10</text>
                        </g>

                        <!-- 중앙 하단 1개 방 -->
                        <g class="room-group" data-room="3-11" data-type="classroom">
                            <rect class="room-shape classroom" x="435" y="625" width="65" height="65" rx="5"/>
                            <text class="room-label" x="467" y="662" text-anchor="middle">3-11</text>
                        </g>

                        <!-- 하단 5개 가로 방 -->
                        <g class="room-group" data-room="3-12" data-type="classroom">
                            <rect class="room-shape classroom" x="500" y="650" width="60" height="55" rx="5"/>
                            <text class="room-label" x="530" y="682" text-anchor="middle">3-12</text>
                        </g>

                        <g class="room-group" data-room="3-13" data-type="classroom">
                            <rect class="room-shape classroom" x="560" y="680" width="60" height="55" rx="5"/>
                            <text class="room-label" x="590" y="712" text-anchor="middle">3-13</text>
                        </g>

                        <g class="room-group" data-room="3-14" data-type="classroom">
                            <rect class="room-shape classroom" x="635" y="680" width="60" height="55" rx="5"/>
                            <text class="room-label" x="665" y="712" text-anchor="middle">3-14</text>
                        </g>

                        <g class="room-group" data-room="3-15" data-type="classroom">
                            <rect class="room-shape classroom" x="695" y="680" width="55" height="55" rx="5"/>
                            <text class="room-label" x="722" y="712" text-anchor="middle">3-15</text>
                        </g>

                        <g class="room-group" data-room="3-16" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="680" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="712" text-anchor="middle">3-16</text>
                        </g>

                        <g class="room-group" data-room="비상구3" data-type="emergency">
                            <rect class="room-shape emergency" x="820" y="735" width="55" height="60" rx="5"/>
                            <text class="room-label" x="847" y="770" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <!-- 오른쪽 세로 3개 방 -->
                        <g class="room-group" data-room="3-17" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="400" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="432" text-anchor="middle">3-17</text>
                        </g>

                        <g class="room-group" data-room="3-18" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="475" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="507" text-anchor="middle">3-18</text>
                        </g>

                        <g class="room-group" data-room="3-19" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="550" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="582" text-anchor="middle">3-19</text>
                        </g>

                        <!-- 비상구4 추가 -->
                        <g class="room-group" data-room="비상구4" data-type="emergency">
                            <rect class="room-shape emergency" x="820" y="183" width="55" height="52" rx="5"/>
                            <text class="room-label" x="847" y="214" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <!-- Waypoints (붉은 점) - 이미지 원본 위치 기준 + 세분화된 중간 점들 -->
                        <!-- 왼쪽 세로 방들 (비상구1 아래 복도) -->
                        <circle class="waypoint" cx="170" cy="240" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w1"/>

                        <!-- 왼쪽 세로 방들 (3-1 ~ 3-5) - 더 촘촘하게 세분화 -->
                        <circle class="waypoint" cx="170" cy="269" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w2"/>
                        <circle class="waypoint" cx="170" cy="299" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w3"/>
                        <circle class="waypoint" cx="170" cy="329" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w4"/>
                        <circle class="waypoint" cx="170" cy="359" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w5"/>
                        <circle class="waypoint" cx="170" cy="389" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w6"/>
                        <circle class="waypoint" cx="170" cy="419" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w7"/>
                        <circle class="waypoint" cx="170" cy="449" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w8"/>
                        <circle class="waypoint" cx="170" cy="479" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w9"/>
                        <circle class="waypoint" cx="170" cy="509" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w10"/>
                        <circle class="waypoint" cx="170" cy="539" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w11"/>
                        <circle class="waypoint" cx="170" cy="569" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w12"/>
                        <circle class="waypoint" cx="170" cy="595" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w12"/>

                        <!-- 왼쪽 하단 가로 복도 - 세분화 -->
                        <circle class="waypoint" cx="230" cy="570" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w23"/>
                        <circle class="waypoint" cx="248" cy="568" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w24"/>
                        <circle class="waypoint" cx="267" cy="567" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w25"/>
                        <circle class="waypoint" cx="286" cy="566" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w26"/>
                        <circle class="waypoint" cx="305" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w27"/>
                        <circle class="waypoint" cx="323" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w28"/>
                        <circle class="waypoint" cx="342" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w29"/>
                        <circle class="waypoint" cx="361" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w30"/>
                        <circle class="waypoint" cx="380" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w31"/>

                        <!-- 회의실/상담실 아래 연결 -->
                        <circle class="waypoint" cx="395" cy="515" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w32"/>
                        <circle class="waypoint" cx="410" cy="530" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w33"/>
                        <circle class="waypoint" cx="430" cy="545" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w34"/>
                        <circle class="waypoint" cx="465" cy="530" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w35"/>
                        <circle class="waypoint" cx="480" cy="545" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w36"/>

                        <!-- 4-11 위쪽 중간 웨이포인트 -->
                        <circle class="waypoint" cx="467" cy="600" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w36a"/>

                        <!-- 중앙 하단에서 하단 가로 복도로 연결 -->
                        <circle class="waypoint" cx="480" cy="580" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w37"/>
                        <circle class="waypoint" cx="490" cy="592" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w38"/>

                        <!-- 하단 가로 방들 - 세분화 -->
                        <circle class="waypoint" cx="525" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w39"/>
                        <circle class="waypoint" cx="541" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w40"/>
                        <circle class="waypoint" cx="557" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w41"/>
                        <circle class="waypoint" cx="573" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w42"/>
                        <circle class="waypoint" cx="590" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w43"/>
                        <circle class="waypoint" cx="607" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w44"/>
                        <circle class="waypoint" cx="625" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w45"/>
                        <circle class="waypoint" cx="642" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w46"/>
                        <circle class="waypoint" cx="660" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w47"/>
                        <circle class="waypoint" cx="677" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w48"/>
                        <circle class="waypoint" cx="695" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w49"/>
                        <circle class="waypoint" cx="712" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w50"/>
                        <circle class="waypoint" cx="730" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w51"/>
                        <circle class="waypoint" cx="747" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w52"/>
                        <circle class="waypoint" cx="765" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w53"/>
                        <circle class="waypoint" cx="782" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w54"/>
                        <circle class="waypoint" cx="800" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w55"/>
                        <circle class="waypoint" cx="825" cy="663" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w56"/>
                        <circle class="waypoint" cx="850" cy="677" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w57"/>
                        <circle class="waypoint" cx="875" cy="691" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w58"/>
                        <circle class="waypoint" cx="847" cy="735" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w76"/>

                        <!-- 오른쪽 세로 방들 - 세분화 -->
                        <circle class="waypoint" cx="830" cy="427" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w60"/>
                        <circle class="waypoint" cx="830" cy="445" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w61"/>
                        <circle class="waypoint" cx="830" cy="464" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w62"/>
                        <circle class="waypoint" cx="830" cy="483" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w63"/>
                        <circle class="waypoint" cx="830" cy="502" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w64"/>
                        <circle class="waypoint" cx="830" cy="520" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w65"/>
                        <circle class="waypoint" cx="830" cy="539" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w66"/>
                        <circle class="waypoint" cx="830" cy="558" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w67"/>
                        <circle class="waypoint" cx="830" cy="577" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w68"/>
                        <circle class="waypoint" cx="830" cy="615" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w70"/>
                        <circle class="waypoint" cx="835" cy="655" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w72"/>
                        <circle class="waypoint" cx="847" cy="735" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w76"/>

                        <!-- 비상구4에서 오른쪽 복도로 연결 -->
                        <circle class="waypoint" cx="830" cy="250" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w78"/>
                        <circle class="waypoint" cx="830" cy="300" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w79"/>
                        <circle class="waypoint" cx="830" cy="337" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w79a"/>
                        <circle class="waypoint" cx="830" cy="350" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w80"/>
                        <circle class="waypoint" cx="830" cy="390" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w81"/>

                        <!-- Waypoint connections (통로 선) -->
                        <g id="waypointPaths" stroke="#e0e0e0" stroke-width="2" fill="none" opacity="0.5">
                            <!-- 왼쪽 세로 연결 -->
                            <line x1="185" y1="110" x2="170" y2="155" data-path="w1-w2"/>
                            <line x1="170" y1="155" x2="170" y2="230" data-path="w2-w3"/>
                            <line x1="170" y1="230" x2="170" y2="305" data-path="w3-w4"/>
                            <line x1="170" y1="305" x2="170" y2="380" data-path="w4-w5"/>
                            <line x1="170" y1="380" x2="170" y2="455" data-path="w5-w6"/>
                            <line x1="170" y1="455" x2="170" y2="530" data-path="w6-w7"/>

                            <!-- 왼쪽 하단 연결 -->
                            <line x1="170" y1="530" x2="230" y2="570" data-path="w7-w8"/>
                            <line x1="230" y1="570" x2="305" y2="565" data-path="w8-w9"/>
                            <line x1="305" y1="565" x2="380" y2="565" data-path="w9-w10"/>

                            <!-- 중앙 연결 -->
                            <line x1="380" y1="565" x2="385" y2="525" data-path="w10-w11"/>
                            <line x1="385" y1="525" x2="455" y2="525" data-path="w11-w12"/>

                            <!-- 중앙에서 하단으로 -->
                            <line x1="455" y1="525" x2="460" y2="605" data-path="w12-w13"/>
                            <line x1="460" y1="605" x2="525" y2="650" data-path="w13-w14"/>
                            <line x1="525" y1="650" x2="590" y2="650" data-path="w14-w15"/>
                            <line x1="590" y1="650" x2="660" y2="650" data-path="w15-w16"/>
                            <line x1="660" y1="650" x2="730" y2="650" data-path="w16-w17"/>
                            <line x1="730" y1="650" x2="800" y2="650" data-path="w17-w18"/>
                            <line x1="800" y1="650" x2="835" y2="655" data-path="w18-w72"/>
                            <line x1="835" y1="655" x2="847" y2="735" data-path="w72-w76"/>

                            <!-- 오른쪽 연결 -->
                            <line x1="847" y1="735" x2="835" y2="655" data-path="w76-w72"/>
                            <line x1="835" y1="655" x2="830" y2="615" data-path="w72-w70"/>
                            <line x1="830" y1="615" x2="830" y2="577" data-path="w70-w68"/>

                            <!-- 오른쪽 세로 연결 -->
                            <line x1="830" y1="577" x2="830" y2="502" data-path="w68-w64"/>
                            <line x1="830" y1="502" x2="830" y2="427" data-path="w64-w60"/>

                        </g>

                        <!-- Path Layer (for animated navigation) -->
                        <g id="pathLayer">
                            <!-- Dynamic path will be drawn here -->
                        </g>

                        <defs>
                            <marker id="arrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
                                <polygon points="0 0, 6 2, 0 4" fill="#667eea" />
                            </marker>
                        </defs>
                    </svg>
                </div>

                <!-- List View -->
                <div class="map-grid" data-view-type="list" style="display: none;">
                    <div class="room-card" data-room="3-1" data-type="classroom">
                        <div class="room-number">3-1</div>
                        <div class="room-name">3학년 1반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="3-2" data-type="classroom">
                        <div class="room-number">3-2</div>
                        <div class="room-name">3학년 2반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="3-3" data-type="classroom">
                        <div class="room-number">3-3</div>
                        <div class="room-name">3학년 3반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="3-4" data-type="classroom">
                        <div class="room-number">3-4</div>
                        <div class="room-name">3학년 4반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="3-5" data-type="classroom">
                        <div class="room-number">3-5</div>
                        <div class="room-name">3학년 5반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">음악실 1</div>
                        <div class="room-name">밴드 연습실</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">음악실 2</div>
                        <div class="room-name">합창 연습실</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">미술실</div>
                        <div class="room-name">미술 수업 전용</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="admin">
                        <div class="room-number">3학년부</div>
                        <div class="room-name">3학년 교무실</div>
                        <span class="room-type admin">행정실</span>
                    </div>
                    <div class="room-card" data-type="facility">
                        <div class="room-number">화장실</div>
                        <div class="room-name">남/여 화장실</div>
                        <span class="room-type facility">편의시설</span>
                    </div>
                    <div class="room-card" data-type="facility">
                        <div class="room-number">휴게실</div>
                        <div class="room-name">학생 휴게 공간</div>
                        <span class="room-type facility">편의시설</span>
                    </div>
                </div>
            </div>

            <!-- 2층 -->
            <div class="floor-map" data-floor="2">
                <!-- Real Image View -->
                <div class="floor-image-container" data-view-type="image" style="display: none;">
                    <img src="2층.PNG" alt="2층 실제 도면" class="floor-image">
                </div>

                <!-- List View -->
                <div class="floor-list-container" data-view-type="list" style="display: none;">
                    <div class="room-list" id="room-list-2"></div>
                </div>

                <!-- SVG Floor Plan -->
                <div class="floor-plan-container" data-view-type="plan">
                    <svg class="floor-plan" viewBox="0 0 1000 800" xmlns="http://www.w3.org/2000/svg">
                        <!-- Background -->
                        <rect width="1000" height="800" fill="#f5f5f5"/>

                        <!-- 복도 벽 (2층) -->
                        <g class="corridor-walls">
                            <!-- 대각선 복도 (2-10 바닥 오른쪽 모서리 → 2-14 위쪽 오른쪽 모서리 방향, 2-16 바닥선과 만나는 지점에서 멈춤) -->
                            <line x1="495" y1="520" x2="631" y2="605" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 가로선 (2-16 바닥 높이에서 대각선 교차점까지) -->
                            <line x1="792" y1="605" x2="631" y2="605" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 추가 대각선 복도 (2-8/2-9 오른쪽아래 → 2-14 왼쪽아래) -->
                            <line x1="425" y1="645" x2="635" y2="735" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 가로선 (비상구2 바닥에서 왼쪽으로, 비상구1 오른쪽과 만나는 지점까지) -->
                            <line x1="365" y1="515" x2="212" y2="515" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 세로선 (비상구1 오른쪽 바닥에서 아래로) -->
                            <line x1="212" y1="235" x2="212" y2="515" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 중간 세로선 (비상구4 왼쪽에서 2-17 오른쪽까지) -->
                            <line x1="820" y1="235" x2="820" y2="400" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 오른쪽 세로선 (비상구4 아래 → 2-17, 2-18, 2-19 왼쪽 → 비상구3까지) -->
                            <line x1="875" y1="235" x2="875" y2="810" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>
                        </g>

                        <!-- 왼쪽 세로 방들 -->
                        <g class="room-group" data-room="비상구1" data-type="emergency">
                            <rect class="room-shape emergency" x="160" y="183" width="52" height="52" rx="5"/>
                            <text class="room-label" x="186" y="214" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <g class="room-group" data-room="2-1" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="243" width="52" height="70" rx="5"/>
                            <text class="room-label" x="131" y="283" text-anchor="middle">2-1</text>
                        </g>

                        <g class="room-group" data-room="2-2" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="313" width="52" height="70" rx="5"/>
                            <text class="room-label" x="131" y="353" text-anchor="middle">2-2</text>
                        </g>

                        <g class="room-group" data-room="2-3" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="383" width="52" height="71" rx="5"/>
                            <text class="room-label" x="131" y="423" text-anchor="middle">2-3</text>
                        </g>

                        <g class="room-group" data-room="2-4" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="454" width="52" height="71" rx="5"/>
                            <text class="room-label" x="131" y="494" text-anchor="middle">2-4</text>
                        </g>

                        <g class="room-group" data-room="2-5" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="525" width="52" height="70" rx="5"/>
                            <text class="room-label" x="131" y="565" text-anchor="middle">2-5</text>
                        </g>

                        <!-- 왼쪽 하단 3개 가로 방 -->
                        <g class="room-group" data-room="2-7" data-type="facility">
                            <rect class="room-shape facility" x="210" y="595" width="55" height="50" rx="5"/>
                            <text class="room-label" x="237" y="625" text-anchor="middle" font-size="11">2-7</text>
                        </g>

                        <g class="room-group" data-room="2-8" data-type="facility">
                            <rect class="room-shape facility" x="285" y="595" width="140" height="50" rx="5"/>
                            <text class="room-label" x="355" y="625" text-anchor="middle" font-size="11">2-8/2-9</text>
                        </g>

                        <!-- 중앙 2개 방 -->
                        <g class="room-group" data-room="비상구2" data-type="emergency">
                            <rect class="room-shape emergency" x="365" y="455" width="60" height="60" rx="5"/>
                            <text class="room-label" x="395" y="490" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <g class="room-group" data-room="2-10" data-type="admin">
                            <rect class="room-shape admin" x="435" y="455" width="60" height="65" rx="5"/>
                            <text class="room-label" x="465" y="493" text-anchor="middle" font-size="11">2-10</text>
                        </g>

                        <!-- 하단 가로 방 -->
                        <g class="room-group" data-room="2-14" data-type="classroom">
                            <rect class="room-shape classroom" x="635" y="680" width="60" height="55" rx="5"/>
                            <text class="room-label" x="665" y="712" text-anchor="middle">2-14</text>
                        </g>

                        <g class="room-group" data-room="2-15" data-type="classroom">
                            <rect class="room-shape classroom" x="695" y="680" width="55" height="55" rx="5"/>
                            <text class="room-label" x="722" y="712" text-anchor="middle">2-15</text>
                        </g>

                        <g class="room-group" data-room="2-16" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="680" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="712" text-anchor="middle">2-16</text>
                        </g>

                        <g class="room-group" data-room="비상구3" data-type="emergency">
                            <rect class="room-shape emergency" x="820" y="735" width="55" height="60" rx="5"/>
                            <text class="room-label" x="847" y="770" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <!-- 오른쪽 세로 3개 방 -->
                        <g class="room-group" data-room="2-17" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="400" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="432" text-anchor="middle">2-17</text>
                        </g>

                        <g class="room-group" data-room="2-18" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="475" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="507" text-anchor="middle">2-18</text>
                        </g>

                        <g class="room-group" data-room="2-19" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="550" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="582" text-anchor="middle">2-19</text>
                        </g>

                        <!-- 비상구4 추가 -->
                        <g class="room-group" data-room="비상구4" data-type="emergency">
                            <rect class="room-shape emergency" x="820" y="183" width="55" height="52" rx="5"/>
                            <text class="room-label" x="847" y="214" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <!-- 2-17 위에 추가된 방 -->
                        <g class="room-group" data-room="2-20" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="310" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="342" text-anchor="middle">2-20</text>
                        </g>

                        <!-- Waypoints (붉은 점) - 이미지 원본 위치 기준 + 세분화된 중간 점들 -->

                        <!-- 왼쪽 세로 방들 (비상구1 아래 복도) -->
                        <circle class="waypoint" cx="170" cy="240" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w1"/>

                        <!-- 왼쪽 세로 방들 (2-1 ~ 2-5) - 더 촘촘하게 세분화 -->
                        <circle class="waypoint" cx="170" cy="269" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w2"/>
                        <circle class="waypoint" cx="170" cy="299" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w3"/>
                        <circle class="waypoint" cx="170" cy="329" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w4"/>
                        <circle class="waypoint" cx="170" cy="359" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w5"/>
                        <circle class="waypoint" cx="170" cy="389" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w6"/>
                        <circle class="waypoint" cx="170" cy="419" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w7"/>
                        <circle class="waypoint" cx="170" cy="449" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w8"/>
                        <circle class="waypoint" cx="170" cy="479" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w9"/>
                        <circle class="waypoint" cx="170" cy="509" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w10"/>
                        <circle class="waypoint" cx="170" cy="539" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w11"/>
                        <circle class="waypoint" cx="170" cy="569" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w12"/>
                        <circle class="waypoint" cx="170" cy="595" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w12"/>

                        <!-- 왼쪽 하단 가로 복도 - 세분화 -->
                        <circle class="waypoint" cx="230" cy="570" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w23"/>
                        <circle class="waypoint" cx="248" cy="568" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w24"/>
                        <circle class="waypoint" cx="267" cy="567" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w25"/>
                        <circle class="waypoint" cx="286" cy="566" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w26"/>
                        <circle class="waypoint" cx="305" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w27"/>
                        <circle class="waypoint" cx="323" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w28"/>
                        <circle class="waypoint" cx="342" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w29"/>
                        <circle class="waypoint" cx="361" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w30"/>
                        <circle class="waypoint" cx="380" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w31"/>

                        <!-- 회의실/상담실 아래 연결 -->
                        <circle class="waypoint" cx="395" cy="515" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w32"/>
                        <circle class="waypoint" cx="410" cy="530" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w33"/>
                        <circle class="waypoint" cx="430" cy="545" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w34"/>
                        <circle class="waypoint" cx="465" cy="530" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w35"/>
                        <circle class="waypoint" cx="480" cy="545" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w36"/>

                        <!-- 4-11 위쪽 중간 웨이포인트 -->
                        <circle class="waypoint" cx="467" cy="600" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w36a"/>

                        <!-- 중앙 하단에서 하단 가로 복도로 연결 -->
                        <circle class="waypoint" cx="480" cy="580" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w37"/>
                        <circle class="waypoint" cx="490" cy="592" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w38"/>

                        <!-- 하단 가로 방들 - 세분화 -->
                        <circle class="waypoint" cx="525" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w39"/>
                        <circle class="waypoint" cx="541" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w40"/>
                        <circle class="waypoint" cx="557" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w41"/>
                        <circle class="waypoint" cx="573" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w42"/>
                        <circle class="waypoint" cx="590" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w43"/>
                        <circle class="waypoint" cx="607" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w44"/>
                        <circle class="waypoint" cx="625" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w45"/>
                        <circle class="waypoint" cx="642" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w46"/>
                        <circle class="waypoint" cx="660" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w47"/>
                        <circle class="waypoint" cx="677" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w48"/>
                        <circle class="waypoint" cx="695" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w49"/>
                        <circle class="waypoint" cx="712" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w50"/>
                        <circle class="waypoint" cx="730" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w51"/>
                        <circle class="waypoint" cx="747" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w52"/>
                        <circle class="waypoint" cx="765" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w53"/>
                        <circle class="waypoint" cx="782" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w54"/>
                        <circle class="waypoint" cx="800" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w55"/>
                        <circle class="waypoint" cx="825" cy="663" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w56"/>
                        <circle class="waypoint" cx="850" cy="677" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w57"/>
                        <circle class="waypoint" cx="875" cy="691" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w58"/>
                        <circle class="waypoint" cx="847" cy="735" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w76"/>

                        <!-- 오른쪽 세로 방들 - 세분화 -->
                        <circle class="waypoint" cx="830" cy="427" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w60"/>
                        <circle class="waypoint" cx="830" cy="445" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w61"/>
                        <circle class="waypoint" cx="830" cy="464" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w62"/>
                        <circle class="waypoint" cx="830" cy="483" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w63"/>
                        <circle class="waypoint" cx="830" cy="502" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w64"/>
                        <circle class="waypoint" cx="830" cy="520" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w65"/>
                        <circle class="waypoint" cx="830" cy="539" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w66"/>
                        <circle class="waypoint" cx="830" cy="558" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w67"/>
                        <circle class="waypoint" cx="830" cy="577" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w68"/>
                        <circle class="waypoint" cx="830" cy="615" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w70"/>
                        <circle class="waypoint" cx="835" cy="655" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w72"/>
                        <circle class="waypoint" cx="847" cy="735" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w76"/>

                        <!-- 비상구4에서 오른쪽 복도로 연결 -->
                        <circle class="waypoint" cx="830" cy="250" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w78"/>
                        <circle class="waypoint" cx="830" cy="300" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w79"/>
                        <circle class="waypoint" cx="830" cy="337" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w79a"/>
                        <circle class="waypoint" cx="830" cy="350" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w80"/>
                        <circle class="waypoint" cx="830" cy="390" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w81"/>

                        <!-- Waypoint connections (통로 선) -->
                        <g id="waypointPaths" stroke="#e0e0e0" stroke-width="2" fill="none" opacity="0.5">
                            <!-- 왼쪽 세로 연결 -->
                            <line x1="185" y1="110" x2="170" y2="155" data-path="w1-w2"/>
                            <line x1="170" y1="155" x2="170" y2="230" data-path="w2-w3"/>
                            <line x1="170" y1="230" x2="170" y2="305" data-path="w3-w4"/>
                            <line x1="170" y1="305" x2="170" y2="380" data-path="w4-w5"/>
                            <line x1="170" y1="380" x2="170" y2="455" data-path="w5-w6"/>
                            <line x1="170" y1="455" x2="170" y2="530" data-path="w6-w7"/>

                            <!-- 왼쪽 하단 연결 -->
                            <line x1="170" y1="530" x2="230" y2="570" data-path="w7-w8"/>
                            <line x1="230" y1="570" x2="305" y2="565" data-path="w8-w9"/>
                            <line x1="305" y1="565" x2="380" y2="565" data-path="w9-w10"/>

                            <!-- 중앙 연결 -->
                            <line x1="380" y1="565" x2="385" y2="525" data-path="w10-w11"/>
                            <line x1="385" y1="525" x2="455" y2="525" data-path="w11-w12"/>

                            <!-- 중앙에서 하단으로 -->
                            <line x1="455" y1="525" x2="460" y2="605" data-path="w12-w13"/>
                            <line x1="460" y1="605" x2="525" y2="650" data-path="w13-w14"/>
                            <line x1="525" y1="650" x2="590" y2="650" data-path="w14-w15"/>
                            <line x1="590" y1="650" x2="660" y2="650" data-path="w15-w16"/>
                            <line x1="660" y1="650" x2="730" y2="650" data-path="w16-w17"/>
                            <line x1="730" y1="650" x2="800" y2="650" data-path="w17-w18"/>
                            <line x1="800" y1="650" x2="835" y2="655" data-path="w18-w72"/>
                            <line x1="835" y1="655" x2="847" y2="735" data-path="w72-w76"/>

                            <!-- 오른쪽 연결 -->
                            <line x1="847" y1="735" x2="835" y2="655" data-path="w76-w72"/>
                            <line x1="835" y1="655" x2="830" y2="615" data-path="w72-w70"/>
                            <line x1="830" y1="615" x2="830" y2="577" data-path="w70-w68"/>

                            <!-- 오른쪽 세로 연결 -->
                            <line x1="830" y1="577" x2="830" y2="502" data-path="w68-w64"/>
                            <line x1="830" y1="502" x2="830" y2="427" data-path="w64-w60"/>

                        </g>

                        <!-- Path Layer (for animated navigation) -->
                        <g id="pathLayer">
                            <!-- Dynamic path will be drawn here -->
                        </g>

                        <defs>
                            <marker id="arrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
                                <polygon points="0 0, 6 2, 0 4" fill="#667eea" />
                            </marker>
                        </defs>
                    </svg>
                </div>

                <!-- List View -->
                <div class="map-grid" data-view-type="list" style="display: none;">
                    <div class="room-card" data-room="2-1" data-type="classroom">
                        <div class="room-number">2-1</div>
                        <div class="room-name">2학년 1반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="2-2" data-type="classroom">
                        <div class="room-number">2-2</div>
                        <div class="room-name">2학년 2반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="2-3" data-type="classroom">
                        <div class="room-number">2-3</div>
                        <div class="room-name">2학년 3반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="2-4" data-type="classroom">
                        <div class="room-number">2-4</div>
                        <div class="room-name">2학년 4반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="2-5" data-type="classroom">
                        <div class="room-number">2-5</div>
                        <div class="room-name">2학년 5반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">음악실 1</div>
                        <div class="room-name">밴드 연습실</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">음악실 2</div>
                        <div class="room-name">합창 연습실</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">미술실</div>
                        <div class="room-name">미술 수업 전용</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="admin">
                        <div class="room-number">2학년부</div>
                        <div class="room-name">2학년 교무실</div>
                        <span class="room-type admin">행정실</span>
                    </div>
                    <div class="room-card" data-type="facility">
                        <div class="room-number">화장실</div>
                        <div class="room-name">남/여 화장실</div>
                        <span class="room-type facility">편의시설</span>
                    </div>
                    <div class="room-card" data-type="facility">
                        <div class="room-number">휴게실</div>
                        <div class="room-name">학생 휴게 공간</div>
                        <span class="room-type facility">편의시설</span>
                    </div>
                </div>
            </div>
            <!-- 1층 -->
            <div class="floor-map" data-floor="1">
                <!-- Real Image View -->
                <div class="floor-image-container" data-view-type="image" style="display: none;">
                    <img src="1층.PNG" alt="1층 실제 도면" class="floor-image">
                </div>

                <!-- List View -->
                <div class="floor-list-container" data-view-type="list" style="display: none;">
                    <div class="room-list" id="room-list-1"></div>
                </div>

                <!-- SVG Floor Plan -->
                <div class="floor-plan-container" data-view-type="plan">
                    <svg class="floor-plan" viewBox="0 0 1000 800" xmlns="http://www.w3.org/2000/svg">
                        <!-- Background -->
                        <rect width="1000" height="800" fill="#f5f5f5"/>

                        <!-- 복도 벽 (1층) -->
                        <g class="corridor-walls">
                            <!-- 대각선 복도 (2-10 바닥 오른쪽 모서리 → 1-14 위쪽 오른쪽 모서리 방향, 1-16 바닥선과 만나는 지점에서 멈춤) -->
                            <line x1="495" y1="520" x2="631" y2="605" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 가로선 (2-16 바닥 높이에서 대각선 교차점까지) -->
                            <line x1="792" y1="605" x2="631" y2="605" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 추가 대각선 복도 (2-8/2-9 오른쪽아래 → 1-14 왼쪽아래) -->
                            <line x1="425" y1="645" x2="635" y2="735" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 가로선 (비상구2 바닥에서 왼쪽으로, 비상구1 오른쪽과 만나는 지점까지) -->
                            <line x1="365" y1="515" x2="212" y2="515" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 세로선 (비상구1 오른쪽 바닥에서 아래로) -->
                            <line x1="212" y1="235" x2="212" y2="515" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 중간 세로선 (비상구4 왼쪽에서 1-17 오른쪽까지) -->
                            <line x1="820" y1="235" x2="820" y2="400" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>

                            <!-- 오른쪽 세로선 (비상구4 아래 → 2-17, 2-18, 1-19 왼쪽 → 비상구3까지) -->
                            <line x1="875" y1="235" x2="875" y2="810" stroke="#9ca3af" stroke-width="3" opacity="0.6"/>
                        </g>

                        <!-- 왼쪽 세로 방들 -->
                        <g class="room-group" data-room="비상구1" data-type="emergency">
                            <rect class="room-shape emergency" x="160" y="183" width="52" height="52" rx="5"/>
                            <text class="room-label" x="186" y="214" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <g class="room-group" data-room="1-1" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="243" width="52" height="70" rx="5"/>
                            <text class="room-label" x="131" y="283" text-anchor="middle">1-1</text>
                        </g>

                        <g class="room-group" data-room="1-2" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="313" width="52" height="70" rx="5"/>
                            <text class="room-label" x="131" y="353" text-anchor="middle">1-2</text>
                        </g>

                        <g class="room-group" data-room="1-3" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="383" width="52" height="71" rx="5"/>
                            <text class="room-label" x="131" y="423" text-anchor="middle">1-3</text>
                        </g>

                        <g class="room-group" data-room="1-4" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="454" width="52" height="71" rx="5"/>
                            <text class="room-label" x="131" y="494" text-anchor="middle">1-4</text>
                        </g>

                        <g class="room-group" data-room="1-5" data-type="classroom">
                            <rect class="room-shape classroom" x="105" y="525" width="52" height="70" rx="5"/>
                            <text class="room-label" x="131" y="565" text-anchor="middle">1-5</text>
                        </g>

                        <!-- 왼쪽 하단 3개 가로 방 -->
                        <g class="room-group" data-room="1-7" data-type="facility">
                            <rect class="room-shape facility" x="210" y="595" width="55" height="50" rx="5"/>
                            <text class="room-label" x="237" y="625" text-anchor="middle" font-size="11">1-7</text>
                        </g>

                        <g class="room-group" data-room="1-8" data-type="facility">
                            <rect class="room-shape facility" x="285" y="595" width="140" height="50" rx="5"/>
                            <text class="room-label" x="355" y="625" text-anchor="middle" font-size="11">1-8/1-9</text>
                        </g>

                        <!-- 중앙 2개 방 -->
                        <g class="room-group" data-room="비상구2" data-type="emergency">
                            <rect class="room-shape emergency" x="365" y="455" width="60" height="60" rx="5"/>
                            <text class="room-label" x="395" y="490" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <g class="room-group" data-room="1-10" data-type="admin">
                            <rect class="room-shape admin" x="435" y="455" width="60" height="65" rx="5"/>
                            <text class="room-label" x="465" y="493" text-anchor="middle" font-size="11">1-10</text>
                        </g>

                        <!-- 하단 가로 방 -->
                        <g class="room-group" data-room="1-14" data-type="classroom">
                            <rect class="room-shape classroom" x="580" y="680" width="60" height="55" rx="5"/>
                            <text class="room-label" x="610" y="712" text-anchor="middle">1-14</text>
                        </g>

                        <g class="room-group" data-room="1-15" data-type="classroom">
                            <rect class="room-shape classroom" x="640" y="680" width="55" height="55" rx="5"/>
                            <text class="room-label" x="667" y="712" text-anchor="middle">1-15</text>
                        </g>

                        <g class="room-group" data-room="비상구5" data-type="emergency">
                            <rect class="room-shape emergency" x="695" y="680" width="50" height="55" rx="5"/>
                            <text class="room-label" x="720" y="712" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <g class="room-group" data-room="1-16" data-type="classroom">
                            <rect class="room-shape classroom" x="750" y="680" width="55" height="55" rx="5"/>
                            <text class="room-label" x="777" y="712" text-anchor="middle">1-16</text>
                        </g>

                        <g class="room-group" data-room="비상구3" data-type="emergency">
                            <rect class="room-shape emergency" x="820" y="735" width="55" height="60" rx="5"/>
                            <text class="room-label" x="847" y="770" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <!-- 오른쪽 세로 3개 방 -->
                        <g class="room-group" data-room="1-17" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="400" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="432" text-anchor="middle">1-17</text>
                        </g>

                        <g class="room-group" data-room="1-18" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="475" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="507" text-anchor="middle">1-18</text>
                        </g>

                        <g class="room-group" data-room="1-19" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="550" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="582" text-anchor="middle">1-19</text>
                        </g>

                        <!-- 비상구4 추가 -->
                        <g class="room-group" data-room="비상구4" data-type="emergency">
                            <rect class="room-shape emergency" x="820" y="183" width="55" height="52" rx="5"/>
                            <text class="room-label" x="847" y="214" text-anchor="middle" font-size="10">비상구</text>
                        </g>

                        <!-- 1-17 위에 추가된 방 -->
                        <g class="room-group" data-room="1-20" data-type="classroom">
                            <rect class="room-shape classroom" x="765" y="310" width="55" height="55" rx="5"/>
                            <text class="room-label" x="792" y="342" text-anchor="middle">1-20</text>
                        </g>

                        <!-- Waypoints (붉은 점) - 이미지 원본 위치 기준 + 세분화된 중간 점들 -->

                        <!-- 왼쪽 세로 방들 (비상구1 아래 복도) -->
                        <circle class="waypoint" cx="170" cy="240" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w1"/>

                        <!-- 왼쪽 세로 방들 (1-1 ~ 1-5) - 더 촘촘하게 세분화 -->
                        <circle class="waypoint" cx="170" cy="269" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w2"/>
                        <circle class="waypoint" cx="170" cy="299" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w3"/>
                        <circle class="waypoint" cx="170" cy="329" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w4"/>
                        <circle class="waypoint" cx="170" cy="359" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w5"/>
                        <circle class="waypoint" cx="170" cy="389" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w6"/>
                        <circle class="waypoint" cx="170" cy="419" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w7"/>
                        <circle class="waypoint" cx="170" cy="449" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w8"/>
                        <circle class="waypoint" cx="170" cy="479" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w9"/>
                        <circle class="waypoint" cx="170" cy="509" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w10"/>
                        <circle class="waypoint" cx="170" cy="539" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w11"/>
                        <circle class="waypoint" cx="170" cy="569" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w12"/>
                        <circle class="waypoint" cx="170" cy="595" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w12"/>

                        <!-- 왼쪽 하단 가로 복도 - 세분화 -->
                        <circle class="waypoint" cx="230" cy="570" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w23"/>
                        <circle class="waypoint" cx="248" cy="568" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w24"/>
                        <circle class="waypoint" cx="267" cy="567" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w25"/>
                        <circle class="waypoint" cx="286" cy="566" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w26"/>
                        <circle class="waypoint" cx="305" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w27"/>
                        <circle class="waypoint" cx="323" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w28"/>
                        <circle class="waypoint" cx="342" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w29"/>
                        <circle class="waypoint" cx="361" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w30"/>
                        <circle class="waypoint" cx="380" cy="565" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w31"/>

                        <!-- 회의실/상담실 아래 연결 -->
                        <circle class="waypoint" cx="395" cy="515" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w32"/>
                        <circle class="waypoint" cx="410" cy="530" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w33"/>
                        <circle class="waypoint" cx="430" cy="545" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w34"/>
                        <circle class="waypoint" cx="465" cy="530" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w35"/>
                        <circle class="waypoint" cx="480" cy="545" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w36"/>

                        <!-- 4-11 위쪽 중간 웨이포인트 -->
                        <circle class="waypoint" cx="467" cy="600" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w36a"/>

                        <!-- 중앙 하단에서 하단 가로 복도로 연결 -->
                        <circle class="waypoint" cx="480" cy="580" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w37"/>
                        <circle class="waypoint" cx="490" cy="592" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w38"/>

                        <!-- 하단 가로 방들 - 세분화 -->
                        <circle class="waypoint" cx="525" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w39"/>
                        <circle class="waypoint" cx="541" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w40"/>
                        <circle class="waypoint" cx="557" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w41"/>
                        <circle class="waypoint" cx="573" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w42"/>
                        <circle class="waypoint" cx="590" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w43"/>
                        <circle class="waypoint" cx="607" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w44"/>
                        <circle class="waypoint" cx="625" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w45"/>
                        <circle class="waypoint" cx="642" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w46"/>
                        <circle class="waypoint" cx="660" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w47"/>
                        <circle class="waypoint" cx="677" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w48"/>
                        <circle class="waypoint" cx="695" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w49"/>
                        <circle class="waypoint" cx="712" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w50"/>
                        <circle class="waypoint" cx="730" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w51"/>
                        <circle class="waypoint" cx="720" cy="680" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w51a"/>
                        <circle class="waypoint" cx="747" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w52"/>
                        <circle class="waypoint" cx="765" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w53"/>
                        <circle class="waypoint" cx="782" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w54"/>
                        <circle class="waypoint" cx="800" cy="650" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w55"/>
                        <circle class="waypoint" cx="825" cy="663" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w56"/>
                        <circle class="waypoint" cx="850" cy="677" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w57"/>
                        <circle class="waypoint" cx="875" cy="691" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w58"/>
                        <circle class="waypoint" cx="847" cy="735" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w76"/>

                        <!-- 오른쪽 세로 방들 - 세분화 -->
                        <circle class="waypoint" cx="830" cy="427" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w60"/>
                        <circle class="waypoint" cx="830" cy="445" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w61"/>
                        <circle class="waypoint" cx="830" cy="464" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w62"/>
                        <circle class="waypoint" cx="830" cy="483" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w63"/>
                        <circle class="waypoint" cx="830" cy="502" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w64"/>
                        <circle class="waypoint" cx="830" cy="520" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w65"/>
                        <circle class="waypoint" cx="830" cy="539" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w66"/>
                        <circle class="waypoint" cx="830" cy="558" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w67"/>
                        <circle class="waypoint" cx="830" cy="577" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w68"/>
                        <circle class="waypoint" cx="830" cy="615" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w70"/>
                        <circle class="waypoint" cx="835" cy="655" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w72"/>
                        <circle class="waypoint" cx="847" cy="735" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w76"/>

                        <!-- 비상구4에서 오른쪽 복도로 연결 -->
                        <circle class="waypoint" cx="830" cy="250" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w78"/>
                        <circle class="waypoint" cx="830" cy="300" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w79"/>
                        <circle class="waypoint" cx="830" cy="337" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w79a"/>
                        <circle class="waypoint" cx="830" cy="350" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w80"/>
                        <circle class="waypoint" cx="830" cy="390" r="4" fill="#e74c3c" stroke="white" stroke-width="1" opacity="1" data-waypoint="w81"/>

                        <!-- Waypoint connections (통로 선) -->
                        <g id="waypointPaths" stroke="#e0e0e0" stroke-width="2" fill="none" opacity="0.5">
                            <!-- 왼쪽 세로 연결 -->
                            <line x1="185" y1="110" x2="170" y2="155" data-path="w1-w2"/>
                            <line x1="170" y1="155" x2="170" y2="230" data-path="w2-w3"/>
                            <line x1="170" y1="230" x2="170" y2="305" data-path="w3-w4"/>
                            <line x1="170" y1="305" x2="170" y2="380" data-path="w4-w5"/>
                            <line x1="170" y1="380" x2="170" y2="455" data-path="w5-w6"/>
                            <line x1="170" y1="455" x2="170" y2="530" data-path="w6-w7"/>

                            <!-- 왼쪽 하단 연결 -->
                            <line x1="170" y1="530" x2="230" y2="570" data-path="w7-w8"/>
                            <line x1="230" y1="570" x2="305" y2="565" data-path="w8-w9"/>
                            <line x1="305" y1="565" x2="380" y2="565" data-path="w9-w10"/>

                            <!-- 중앙 연결 -->
                            <line x1="380" y1="565" x2="385" y2="525" data-path="w10-w11"/>
                            <line x1="385" y1="525" x2="455" y2="525" data-path="w11-w12"/>

                            <!-- 중앙에서 하단으로 -->
                            <line x1="455" y1="525" x2="460" y2="605" data-path="w12-w13"/>
                            <line x1="460" y1="605" x2="525" y2="650" data-path="w13-w14"/>
                            <line x1="525" y1="650" x2="590" y2="650" data-path="w14-w15"/>
                            <line x1="590" y1="650" x2="660" y2="650" data-path="w15-w16"/>
                            <line x1="660" y1="650" x2="730" y2="650" data-path="w16-w17"/>
                            <line x1="730" y1="650" x2="800" y2="650" data-path="w17-w18"/>
                            <line x1="800" y1="650" x2="835" y2="655" data-path="w18-w72"/>
                            <line x1="835" y1="655" x2="847" y2="735" data-path="w72-w76"/>

                            <!-- 오른쪽 연결 -->
                            <line x1="847" y1="735" x2="835" y2="655" data-path="w76-w72"/>
                            <line x1="835" y1="655" x2="830" y2="615" data-path="w72-w70"/>
                            <line x1="830" y1="615" x2="830" y2="577" data-path="w70-w68"/>

                            <!-- 오른쪽 세로 연결 -->
                            <line x1="830" y1="577" x2="830" y2="502" data-path="w68-w64"/>
                            <line x1="830" y1="502" x2="830" y2="427" data-path="w64-w60"/>

                        </g>

                        <!-- Path Layer (for animated navigation) -->
                        <g id="pathLayer">
                            <!-- Dynamic path will be drawn here -->
                        </g>

                        <defs>
                            <marker id="arrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
                                <polygon points="0 0, 6 2, 0 4" fill="#667eea" />
                            </marker>
                        </defs>
                    </svg>
                </div>

                <!-- List View -->
                <div class="map-grid" data-view-type="list" style="display: none;">
                    <div class="room-card" data-room="1-1" data-type="classroom">
                        <div class="room-number">1-1</div>
                        <div class="room-name">1학년 1반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="1-2" data-type="classroom">
                        <div class="room-number">1-2</div>
                        <div class="room-name">1학년 2반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="1-3" data-type="classroom">
                        <div class="room-number">1-3</div>
                        <div class="room-name">1학년 3반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="1-4" data-type="classroom">
                        <div class="room-number">1-4</div>
                        <div class="room-name">1학년 4반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-room="1-5" data-type="classroom">
                        <div class="room-number">1-5</div>
                        <div class="room-name">1학년 5반 교실</div>
                        <span class="room-type">교실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">음악실 1</div>
                        <div class="room-name">밴드 연습실</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">음악실 2</div>
                        <div class="room-name">합창 연습실</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="special">
                        <div class="room-number">미술실</div>
                        <div class="room-name">미술 수업 전용</div>
                        <span class="room-type special">특별실</span>
                    </div>
                    <div class="room-card" data-type="admin">
                        <div class="room-number">1학년부</div>
                        <div class="room-name">1학년 교무실</div>
                        <span class="room-type admin">행정실</span>
                    </div>
                    <div class="room-card" data-type="facility">
                        <div class="room-number">화장실</div>
                        <div class="room-name">남/여 화장실</div>
                        <span class="room-type facility">편의시설</span>
                    </div>
                    <div class="room-card" data-type="facility">
                        <div class="room-number">휴게실</div>
                        <div class="room-name">학생 휴게 공간</div>
                        <span class="room-type facility">편의시설</span>
                    </div>
                </div>
            </div>


            <div class="no-results">
                <div class="no-results-icon">🔍</div>
                <h3>검색 결과가 없습니다</h3>
                <p>다른 키워드로 검색해보세요</p>
            </div>
        </main>

        <!-- Right Sidebar - Room List Panel -->
        <aside class="rooms-sidebar">
            <div class="rooms-sidebar-header">
                <div class="rooms-sidebar-title">
                    <i class="fas fa-list"></i>
                    방 목록
                </div>
                <div class="rooms-sidebar-subtitle" id="roomsSidebarSubtitle">4층 - 19개 방</div>
            </div>
            <div class="rooms-sidebar-content">
                <div class="room-list" id="rooms-sidebar-list"></div>
            </div>
        </aside>
    </div>

    <!-- Modal -->
    <div class="modal" id="roomModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">교실 정보</h3>
                <button class="close-btn" id="closeModal">✕</button>
            </div>
            <div class="modal-body" id="modalBody">
                <div class="info-item">
                    <span class="info-label">위치</span>
                    <span>4층</span>
                </div>
                <div class="info-item">
                    <span class="info-label">종류</span>
                    <span>일반 교실</span>
                </div>
                <div class="info-item">
                    <span class="info-label">수용인원</span>
                    <span>30명</span>
                </div>
                <div class="info-item">
                    <span class="info-label">시설</span>
                    <span>프로젝터, 에어컨, 사물함</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toast Notification System
        function showToast(message, type = 'info', title = '') {
            const toastContainer = document.getElementById('toastContainer');

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };

            const titles = {
                success: title || '성공',
                error: title || '오류',
                warning: title || '경고',
                info: title || '알림'
            };

            toast.innerHTML = `
                <i class="${icons[type]} toast-icon"></i>
                <div class="toast-content">
                    <div class="toast-title">${titles[type]}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">
                    <i class="fas fa-times"></i>
                </button>
            `;

            toastContainer.appendChild(toast);

            // Close button
            const closeBtn = toast.querySelector('.toast-close');
            closeBtn.addEventListener('click', () => {
                toast.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            });

            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 5000);
        }

        // Loading Overlay
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // Elements
        const searchInput = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearBtn');
        const floorButtons = document.querySelectorAll('.floor-btn');
        const floorMaps = document.querySelectorAll('.floor-map');
        const roomCards = document.querySelectorAll('.room-card');
        const noResults = document.querySelector('.no-results');
        const modal = document.getElementById('roomModal');
        const closeModalBtn = document.getElementById('closeModal');
        const mapTitle = document.querySelector('.map-title');
        const viewBtns = document.querySelectorAll('.view-btn');

        let currentFloor = '4';
        let currentView = 'plan';

        // 방들의 위치 정보 (장애물로 사용)
        const rooms = [
            { x: 160, y: 183, width: 52, height: 52 },   // 비상구1
            { x: 105, y: 243, width: 52, height: 52 },   // 4-1
            { x: 105, y: 303, width: 52, height: 52 },   // 4-2
            { x: 105, y: 363, width: 52, height: 52 },   // 4-3
            { x: 105, y: 423, width: 52, height: 52 },   // 4-4
            { x: 105, y: 483, width: 52, height: 52 },   // 4-5
            { x: 105, y: 543, width: 52, height: 52 },   // 4-6
            { x: 210, y: 595, width: 55, height: 50 },   // 4-8 (준비실1)
            { x: 285, y: 595, width: 60, height: 50 },   // 4-9 (자료실)
            { x: 365, y: 595, width: 60, height: 50 },   // 4-10 (준비실2)
            { x: 365, y: 450, width: 60, height: 60 },   // 회의실
            { x: 435, y: 455, width: 60, height: 65 },   // 4-11 (상담실)
            { x: 435, y: 625, width: 65, height: 65 },   // 4-1
            { x: 500, y: 680, width: 60, height: 55 },   // 4-13
            { x: 575, y: 680, width: 60, height: 55 },   // 4-17
            { x: 650, y: 680, width: 60, height: 55 },   // 4-18
            { x: 725, y: 680, width: 60, height: 55 },   // 4-12
            { x: 835, y: 745, width: 55, height: 60 },   // 4-13
            { x: 765, y: 400, width: 55, height: 55 },   // 4-14
            { x: 765, y: 475, width: 55, height: 55 },   // 4-15
            { x: 765, y: 550, width: 55, height: 55 }    // 4-16
        ];

        // 선분과 사각형(방)의 교차 여부 체크
        function lineIntersectsRect(x1, y1, x2, y2, rect) {
            // 선분의 양 끝점이 모두 사각형 내부에 있으면 교차로 간주하지 않음 (같은 방 내부)
            const p1Inside = (x1 >= rect.x && x1 <= rect.x + rect.width &&
                            y1 >= rect.y && y1 <= rect.y + rect.height);
            const p2Inside = (x2 >= rect.x && x2 <= rect.x + rect.width &&
                            y2 >= rect.y && y2 <= rect.y + rect.height);

            if (p1Inside && p2Inside) return false;

            // 선분이 사각형의 네 변 중 하나와 교차하는지 체크
            const rectLines = [
                { x1: rect.x, y1: rect.y, x2: rect.x + rect.width, y2: rect.y },                    // 상단
                { x1: rect.x + rect.width, y1: rect.y, x2: rect.x + rect.width, y2: rect.y + rect.height }, // 우측
                { x1: rect.x, y1: rect.y + rect.height, x2: rect.x + rect.width, y2: rect.y + rect.height }, // 하단
                { x1: rect.x, y1: rect.y, x2: rect.x, y2: rect.y + rect.height }                    // 좌측
            ];

            for (const line of rectLines) {
                if (lineSegmentsIntersect(x1, y1, x2, y2, line.x1, line.y1, line.x2, line.y2)) {
                    return true;
                }
            }

            return false;
        }

        // 두 선분의 교차 여부 체크
        function lineSegmentsIntersect(x1, y1, x2, y2, x3, y3, x4, y4) {
            const denominator = ((x2 - x1) * (y4 - y3)) - ((y2 - y1) * (x4 - x3));

            if (denominator === 0) return false;

            const ua = (((x4 - x3) * (y1 - y3)) - ((y4 - y3) * (x1 - x3))) / denominator;
            const ub = (((x2 - x1) * (y1 - y3)) - ((y2 - y1) * (x1 - x3))) / denominator;

            return (ua >= 0 && ua <= 1 && ub >= 0 && ub <= 1);
        }

        // 두 waypoint 사이의 경로가 방을 관통하는지 체크
        function pathCrossesRoom(wp1, wp2) {
            const x1 = waypoints[wp1].x;
            const y1 = waypoints[wp1].y;
            const x2 = waypoints[wp2].x;
            const y2 = waypoints[wp2].y;

            for (const room of rooms) {
                if (lineIntersectsRect(x1, y1, x2, y2, room)) {
                    return true;
                }
            }

            return false;
        }

        // Waypoint graph for 4층 pathfinding (좌표만 저장, neighbors는 동적으로 계산)
        // 벽 구조를 고려하여 재설계됨
        const waypoints = {
            // 왼쪽 복도 (벽 왼쪽, x=170)
            'w1': { x: 170, y: 240 },
            'w2': { x: 170, y: 269 }, 'w3': { x: 170, y: 299 }, 'w4': { x: 170, y: 329 }, 'w5': { x: 170, y: 359 },
            'w6': { x: 170, y: 389 }, 'w7': { x: 170, y: 419 }, 'w8': { x: 170, y: 449 }, 'w9': { x: 170, y: 479 },
            'w10': { x: 170, y: 509 }, 'w11': { x: 170, y: 539 }, 'w12': { x: 170, y: 569 }, 'w13': { x: 170, y: 399 },
            'w14': { x: 170, y: 418 }, 'w15': { x: 170, y: 436 }, 'w16': { x: 170, y: 455 }, 'w17': { x: 170, y: 474 },
            'w18': { x: 170, y: 493 }, 'w19': { x: 170, y: 511 }, 'w20': { x: 170, y: 530 }, 'w21': { x: 170, y: 549 },
            'w22': { x: 170, y: 568 }, 'w23': { x: 170, y: 587 },

            // 왼쪽에서 중앙 하단으로 연결 (벽 아래, y=570)
            'w24': { x: 200, y: 570 }, 'w25': { x: 230, y: 570 }, 'w26': { x: 260, y: 570 },

            // 중앙 하단 교차점 근처
            'w27': { x: 290, y: 570 }, 'w28': { x: 320, y: 570 }, 'w29': { x: 350, y: 570 }, 'w30': { x: 380, y: 570 },
            'w31': { x: 410, y: 570 },

            // 회의실/상담실 아래 연결
            'w32': { x: 395, y: 515 }, 'w33': { x: 410, y: 530 }, 'w34': { x: 430, y: 545 },
            'w35': { x: 465, y: 530 }, 'w36': { x: 480, y: 545 },

            // 4-11 위쪽 중간 웨이포인트
            'w36a': { x: 467, y: 600 },

            // 중앙 하단에서 하단 가로 복도로 연결
            'w37': { x: 480, y: 580 }, 'w38': { x: 490, y: 592 },

            // 하단 가로 복도 (y=650)
            'w39': { x: 525, y: 650 }, 'w40': { x: 541, y: 650 }, 'w41': { x: 557, y: 650 }, 'w42': { x: 573, y: 650 },
            'w43': { x: 590, y: 650 }, 'w44': { x: 607, y: 650 }, 'w45': { x: 625, y: 650 }, 'w46': { x: 642, y: 650 },
            'w47': { x: 660, y: 650 }, 'w48': { x: 677, y: 650 }, 'w49': { x: 695, y: 650 },
            'w50': { x: 712, y: 650 }, 'w51': { x: 730, y: 650 }, 'w52': { x: 747, y: 650 },
            'w53': { x: 765, y: 650 }, 'w54': { x: 782, y: 650 },
            'w55': { x: 800, y: 650 }, 'w56': { x: 825, y: 663 }, 'w57': { x: 850, y: 677 }, 'w58': { x: 875, y: 691 },

            // 오른쪽 세로 복도 (방 밖, x=830)
            'w60': { x: 830, y: 427 }, 'w61': { x: 830, y: 445 }, 'w62': { x: 830, y: 464 },
            'w63': { x: 830, y: 483 }, 'w64': { x: 830, y: 502 },
            'w65': { x: 830, y: 520 }, 'w66': { x: 830, y: 539 }, 'w67': { x: 830, y: 558 },
            'w68': { x: 830, y: 577 }, 'w70': { x: 830, y: 615 },
            'w72': { x: 835, y: 655 }, 'w76': { x: 847, y: 735 },  // 비상구3

            // 비상구4에서 오른쪽 복도로 연결
            'w78': { x: 830, y: 250 }, 'w79': { x: 830, y: 300 },
            'w79a': { x: 830, y: 337 }, // 2-20을 위한 웨이포인트
            'w80': { x: 830, y: 350 }, 'w81': { x: 830, y: 390 }
        };

        // 비상구 위치 정보 (3층과 4층 동일 위치)
        const emergencyExits = {
            '비상구1': { x: 170, y: 240, waypoint: 'w1' },   // 왼쪽 상단 (복도)
            '비상구2': { x: 395, y: 485, waypoint: 'w32' }, // 중앙
            '비상구3': { x: 847, y: 735, waypoint: 'w76' }, // 오른쪽 하단
            '비상구4': { x: 830, y: 250, waypoint: 'w78' }, // 오른쪽 상단
            '비상구5': { x: 720, y: 707, waypoint: 'w51a' } // 하단 중앙 (1층만)
        };

        // 방 번호와 표시 이름 매핑
        const roomDisplayNames = {
            // 1층
            '1-1': '창체부실',
            '1-2': '발간실',
            '1-3': '체육실',
            '1-4': '보건실',
            '1-5': '교장실',
            '1-7': '이사장실',
            '1-8': '행정실',
            '1-10': '화장실1',
            '1-14': '숙직실',
            '1-15': '행정실',
            '1-16': '화장실2',
            '1-17': '물리준비',
            '1-18': '물리실',
            '1-19': '성적처리실',
            '1-20': '과학중점',
            // 2층
            '2-1': '3-1',
            '2-2': '3-2',
            '2-3': '3-3',
            '2-4': '다목적2',
            '2-5': '방송실',
            '2-7': '휴게실',
            '2-8': '교무실',
            '2-10': '화장실1',
            '2-14': '1학년부',
            '2-15': '다목적1',
            '2-16': '화장실2',
            '2-17': '1-3',
            '2-18': '1-2',
            '2-19': '1-1',
            '2-20': '1-4',
            // 3층
            '3-1': '3-4',
            '3-2': '3-5',
            '3-3': '3-6',
            '3-4': '3학년부',
            '3-5': '상담실',
            '3-7': '생활부',
            '3-8': '2-1',
            '3-9': '2-2',
            '3-10': '화장실1',
            '3-11': '제작실',
            '3-12': '2-3',
            '3-13': '2-4',
            '3-14': '2-5',
            '3-15': '2-6',
            '3-16': '화장실2',
            '3-17': '1-7',
            '3-18': '1-6',
            '3-19': '1-5',
            // 4층
            '4-1': '창체부보관',
            '4-2': '3-7',
            '4-3': '3-8',
            '4-4': '3-9',
            '4-5': '3-10',
            '4-6': '인사부',
            '4-7': '미술준비',
            '4-8': '미술실',
            '4-9': '2학년부',
            '4-10': '화장실1',
            '4-11': '여교사휴게실',
            '4-12': '2-7',
            '4-13': '2-8',
            '4-14': '2-9',
            '4-15': '2-10',
            '4-16': '화장실2',
            '4-17': '1-10',
            '4-18': '1-9',
            '4-19': '1-8',
            // 비상구
            '비상구1': '비상구1',
            '비상구2': '비상구2',
            '비상구3': '비상구3',
            '비상구4': '비상구4',
            '비상구5': '비상구5'
        };

        // 4층 방별 웨이포인트 매핑
        const roomToWaypoint = {
            '4-1': 'w1',
            '4-2': 'w2',
            '4-3': 'w4',
            '4-4': 'w6',
            '4-5': 'w8',
            '4-6': 'w10',
            '4-7': 'w24',
            '4-8': 'w26',
            '4-9': 'w29',
            '4-10': 'w35',
            '4-11': 'w36a',
            '4-12': 'w39',
            '4-13': 'w43',
            '4-14': 'w47',
            '4-15': 'w50',
            '4-16': 'w54',
            '4-17': 'w60',
            '4-18': 'w64',
            '4-19': 'w68',
            '비상구1': 'w1',
            '비상구2': 'w32',
            '비상구3': 'w76',
            '비상구4': 'w78',
            '비상구5': 'w51a'
        };

        // 두 waypoint 간 직선 거리 계산
        function getDistance(wp1, wp2) {
            const dx = waypoints[wp1].x - waypoints[wp2].x;
            const dy = waypoints[wp1].y - waypoints[wp2].y;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // 현재 waypoint에서 가장 가까운 K개의 인접 waypoint 찾기
        function getNearestNeighbors(currentWp, k = 10) {
            const neighbors = [];
            const allWaypoints = Object.keys(waypoints);

            for (const wp of allWaypoints) {
                if (wp !== currentWp) {
                    // 방을 관통하는 경로는 제외
                    if (!pathCrossesRoom(currentWp, wp)) {
                        const dist = getDistance(currentWp, wp);
                        neighbors.push({ id: wp, distance: dist });
                    }
                }
            }

            // 거리순으로 정렬하고 가장 가까운 k개 반환
            neighbors.sort((a, b) => a.distance - b.distance);
            return neighbors.slice(0, k).map(n => n.id);
        }

        // Room to waypoint mapping - closest waypoint for each room
        // 방의 중심점에서 가장 가까운 waypoint를 찾는 함수
        function findNearestWaypoint(roomElement) {
            const rect = roomElement.getBBox();
            const centerX = rect.x + rect.width / 2;
            const centerY = rect.y + rect.height / 2;

            let nearestWp = null;
            let minDistance = Infinity;

            Object.keys(waypoints).forEach(wpId => {
                const wp = waypoints[wpId];
                const distance = Math.sqrt(
                    Math.pow(centerX - wp.x, 2) + Math.pow(centerY - wp.y, 2)
                );

                if (distance < minDistance) {
                    minDistance = distance;
                    nearestWp = wpId;
                }
            });

            return nearestWp;
        }

        // 층별 비상구 가용성 정의
        const emergencyExitAvailability = {
            '비상구1': [1, 2, 3, 4],      // 모든 층
            '비상구2': [1, 2, 3, 4],      // 모든 층
            '비상구3': [1, 2, 3, 4],      // 모든 층
            '비상구4': [1, 2, 3],         // 1~3층만
            '비상구5': [1]                // 1층만 (층간 이동 불가)
        };

        // 가장 가까운 비상구 찾기 (방 이름으로부터)
        function findNearestEmergencyExit(roomName, startFloor, endFloor = null) {
            // 층 번호를 숫자로 변환 (문자열일 수 있음)
            startFloor = parseInt(startFloor);
            if (endFloor !== null) {
                endFloor = parseInt(endFloor);
            }

            // 층간 이동 여부 확인
            const isFloorTransfer = endFloor !== null && startFloor !== endFloor;

            console.log(`🔍 findNearestEmergencyExit 호출: room=${roomName}, startFloor=${startFloor} (${typeof startFloor}), endFloor=${endFloor} (${typeof endFloor}), isFloorTransfer=${isFloorTransfer}`);

            // 특정 교실은 비상구2가 더 가까움 (수동 지정)
            const exit2Rooms = [
                '1-5', '1-6', '1-7', '1-8',
                '2-5', '2-6', '2-7', '2-8',
                '3-5', '3-6', '3-7', '3-8',
                '4-5', '4-6', '4-7', '4-8'
            ];

            // SVG에서 해당 방 요소 찾기
            const floorMap = document.querySelector(`.floor-map[data-floor="${startFloor}"]`);
            if (!floorMap) {
                console.error(`❌ floorMap을 찾을 수 없음: floor=${startFloor}`);
                return null;
            }

            const roomGroup = floorMap.querySelector(`.room-group[data-room="${roomName}"]`);
            if (!roomGroup) {
                console.error(`❌ roomGroup을 찾을 수 없음: room=${roomName}`);
                return null;
            }

            const roomShape = roomGroup.querySelector('.room-shape');
            if (!roomShape) {
                console.error(`❌ roomShape을 찾을 수 없음`);
                return null;
            }

            // SVG가 숨겨져 있을 수 있으므로 임시로 보이게 설정
            const originalDisplay = floorMap.style.display;
            if (originalDisplay === 'none') {
                floorMap.style.display = 'block';
            }

            // 방의 중심 좌표 구하기
            const rect = roomShape.getBBox();
            const roomX = rect.x + rect.width / 2;
            const roomY = rect.y + rect.height / 2;

            // 원래 display 상태로 복원
            if (originalDisplay === 'none') {
                floorMap.style.display = 'none';
            }

            console.log(`📍 방 좌표: (${roomX}, ${roomY})`);

            // 각 비상구까지의 거리 계산 (사용 가능한 비상구만)
            let nearestExit = null;
            let minDistance = Infinity;

            console.log(`🚪 비상구 검색 시작...`);
            for (const [exitName, exitPos] of Object.entries(emergencyExits)) {
                // 층별 비상구 가용성 체크
                const exitFloors = emergencyExitAvailability[exitName] || [];
                console.log(`  검사: ${exitName}, 가용층: [${exitFloors}]`);

                // 층간 이동 시: 출발층과 도착층 모두에 존재하고, 비상구5가 아닌 경우만
                if (isFloorTransfer) {
                    if (exitName === '비상구5') {
                        console.log(`    ❌ 스킵: 비상구5는 층간 이동 불가`);
                        continue;
                    }
                    if (!exitFloors.includes(startFloor) || !exitFloors.includes(endFloor)) {
                        console.log(`    ❌ 스킵: 출발층(${startFloor}) 또는 도착층(${endFloor})에 없음`);
                        continue;
                    }
                } else {
                    // 같은 층 내 이동: 현재 층에 존재하는 비상구만
                    if (!exitFloors.includes(startFloor)) {
                        console.log(`    ❌ 스킵: 현재 층(${startFloor})에 없음`);
                        continue;
                    }
                }

                const distance = Math.sqrt(
                    Math.pow(roomX - exitPos.x, 2) + Math.pow(roomY - exitPos.y, 2)
                );
                console.log(`    ✓ 사용 가능, 거리: ${distance.toFixed(2)}`);

                if (distance < minDistance) {
                    minDistance = distance;
                    nearestExit = exitName;
                    console.log(`    🎯 현재 최단 거리 비상구: ${exitName}`);
                }
            }

            // 수동 지정 체크 (층간 이동이 아니고, 해당 교실인 경우)
            if (!isFloorTransfer && exit2Rooms.includes(roomName)) {
                // 비상구2가 현재 층에 있는지 확인
                if (emergencyExitAvailability['비상구2'].includes(startFloor)) {
                    console.log(`✅ 수동 지정: ${roomName} → 비상구2`);
                    return '비상구2';
                }
            }

            console.log(`✅ 최종 선택된 비상구: ${nearestExit || 'null'}`);
            return nearestExit;
        }

        // A* pathfinding algorithm (동적 인접 waypoint 사용)
        function findPath(startWaypoint, endWaypoint) {
            if (!waypoints[startWaypoint] || !waypoints[endWaypoint]) {
                return [];
            }

            const openSet = [startWaypoint];
            const closedSet = new Set();
            const cameFrom = {};
            const gScore = {};
            const fScore = {};

            // Initialize scores
            Object.keys(waypoints).forEach(wp => {
                gScore[wp] = Infinity;
                fScore[wp] = Infinity;
            });
            gScore[startWaypoint] = 0;
            fScore[startWaypoint] = heuristic(startWaypoint, endWaypoint);

            while (openSet.length > 0) {
                // Find node with lowest fScore
                let current = openSet[0];
                let lowestF = fScore[current];
                let currentIndex = 0;
                for (let i = 1; i < openSet.length; i++) {
                    if (fScore[openSet[i]] < lowestF) {
                        current = openSet[i];
                        lowestF = fScore[current];
                        currentIndex = i;
                    }
                }

                if (current === endWaypoint) {
                    return reconstructPath(cameFrom, current);
                }

                openSet.splice(currentIndex, 1);
                closedSet.add(current);

                // 동적으로 가장 가까운 인접 waypoint 찾기
                const neighbors = getNearestNeighbors(current, 10); // 가장 가까운 10개 확인

                neighbors.forEach(neighbor => {
                    if (closedSet.has(neighbor)) return;

                    const tentativeGScore = gScore[current] + getDistance(current, neighbor);

                    if (tentativeGScore < gScore[neighbor]) {
                        cameFrom[neighbor] = current;
                        gScore[neighbor] = tentativeGScore;
                        fScore[neighbor] = gScore[neighbor] + heuristic(neighbor, endWaypoint);

                        if (!openSet.includes(neighbor)) {
                            openSet.push(neighbor);
                        }
                    }
                });
            }

            return [];
        }

        function heuristic(wp1, wp2) {
            return getDistance(wp1, wp2);
        }

        function reconstructPath(cameFrom, current) {
            const path = [current];
            while (cameFrom[current]) {
                current = cameFrom[current];
                path.unshift(current);
            }
            return path;
        }

        // View toggle
        viewBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                viewBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentView = btn.dataset.view;
                toggleView();
            });
        });

        function toggleView() {
            const activeMap = document.querySelector(`.floor-map[data-floor="${currentFloor}"]`);
            const planView = activeMap.querySelector('[data-view-type="plan"]');
            const listView = activeMap.querySelector('[data-view-type="list"]');
            const imageView = activeMap.querySelector('[data-view-type="image"]');

            if (currentView === 'plan') {
                if (planView) planView.style.display = 'block';
                if (listView) listView.style.display = 'none';
                if (imageView) imageView.style.display = 'none';
            } else if (currentView === 'list') {
                if (planView) planView.style.display = 'none';
                if (listView) listView.style.display = 'grid';
                if (imageView) imageView.style.display = 'none';
            } else if (currentView === 'image') {
                if (planView) planView.style.display = 'none';
                if (listView) listView.style.display = 'none';
                if (imageView) imageView.style.display = 'block';
            }
        }

        // Path drawing state
        let selectedRooms = [];
        let pathLine = null;

        // Draw animated path between waypoints
        function drawPath(waypointPath) {
            // Find pathLayer in the currently active floor map
            const activeFloorMap = document.querySelector(`.floor-map[data-floor="${currentFloor}"]`);
            if (!activeFloorMap) return;

            const pathLayer = activeFloorMap.querySelector('#pathLayer');
            if (!pathLayer) return;

            // Clear previous path
            pathLayer.innerHTML = '';

            // Reset all waypoints to default style
            document.querySelectorAll('.waypoint').forEach(wp => {
                wp.setAttribute('r', '7');
                wp.setAttribute('fill', '#e74c3c');
                wp.style.opacity = '1';
            });

            if (waypointPath.length < 2) return;

            // Highlight waypoints in the path
            waypointPath.forEach((wpId, index) => {
                const waypointElement = document.querySelector(`[data-waypoint="${wpId}"]`);
                if (waypointElement) {
                    setTimeout(() => {
                        waypointElement.setAttribute('r', '10');
                        if (index === 0) {
                            // Start waypoint - green
                            waypointElement.setAttribute('fill', '#4caf50');
                        } else if (index === waypointPath.length - 1) {
                            // End waypoint - red
                            waypointElement.setAttribute('fill', '#f44336');
                        } else {
                            // Middle waypoints - orange
                            waypointElement.setAttribute('fill', '#ff9800');
                        }
                        waypointElement.style.transition = 'all 0.3s ease';
                    }, index * 150);
                }
            });

            // Create path string
            let pathData = `M ${waypoints[waypointPath[0]].x} ${waypoints[waypointPath[0]].y}`;
            for (let i = 1; i < waypointPath.length; i++) {
                pathData += ` L ${waypoints[waypointPath[i]].x} ${waypoints[waypointPath[i]].y}`;
            }

            // Create path element
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', pathData);
            path.setAttribute('stroke', '#667eea');
            path.setAttribute('stroke-width', '4');
            path.setAttribute('fill', 'none');
            path.setAttribute('marker-end', 'url(#arrowhead)');

            // Add animation
            const length = path.getTotalLength();
            path.style.strokeDasharray = length + ' ' + length;
            path.style.strokeDashoffset = length;
            path.style.animation = 'dash 2s linear forwards';

            pathLayer.appendChild(path);
        }

        // SVG room interaction
        // 방 라벨을 표시 이름으로 업데이트하는 함수
        function updateRoomLabels() {
            const roomGroups = document.querySelectorAll('.room-group');
            roomGroups.forEach(group => {
                const roomId = group.dataset.room;
                const roomLabel = group.querySelector('.room-label');

                if (roomLabel && roomDisplayNames[roomId]) {
                    roomLabel.textContent = roomDisplayNames[roomId];
                }
            });
        }

        // Select 옵션의 표시 이름을 업데이트하는 함수
        function updateSelectOptions() {
            const selects = document.querySelectorAll('#startLocation, #endLocation');
            selects.forEach(select => {
                const options = select.querySelectorAll('option[value]');
                options.forEach(option => {
                    const roomId = option.value;
                    if (roomId && roomDisplayNames[roomId]) {
                        // 층 정보 추출 (예: "4층 - 4-1"에서 "4층" 부분)
                        const floorMatch = option.textContent.match(/^(\d+층)/);
                        const floor = floorMatch ? floorMatch[1] : '';
                        option.textContent = floor ? `${floor} - ${roomDisplayNames[roomId]}` : roomDisplayNames[roomId];
                    }
                });
            });
        }

        // 방 이름을 표시 이름으로 변환하는 헬퍼 함수
        function getDisplayName(roomId) {
            return roomDisplayNames[roomId] || roomId;
        }

        // 방 타입에 따라 적절한 CSS 클래스를 적용하는 함수
        function applyRoomColors() {
            const roomGroups = document.querySelectorAll('.room-group');
            roomGroups.forEach(group => {
                const roomId = group.dataset.room;
                const displayName = roomDisplayNames[roomId];
                const roomShape = group.querySelector('.room-shape');

                if (!roomShape || !displayName) return;

                // 기존 타입 클래스 제거
                roomShape.classList.remove('classroom', 'admin', 'special', 'facility', 'restroom');

                // 비상구는 이미 emergency 클래스가 있으므로 건너뜀
                if (roomId.startsWith('비상구')) {
                    return;
                }

                // 화장실 판별 (표시 이름이 "화장실"로 시작하는 경우)
                if (displayName.startsWith('화장실')) {
                    roomShape.classList.add('restroom');
                }
                // 교실 판별 (표시 이름이 "숫자-숫자" 패턴인 경우)
                else if (/^\d+-\d+$/.test(displayName)) {
                    roomShape.classList.add('classroom');
                }
                // 나머지는 특수교실로 처리
                else {
                    // 원래 있던 클래스 유지하되, 색상만 FFA500으로 통일
                    if (!roomShape.classList.contains('admin') &&
                        !roomShape.classList.contains('special') &&
                        !roomShape.classList.contains('facility')) {
                        roomShape.classList.add('facility');
                    }
                }
            });
        }

        // 방 타입 판별 함수
        function getRoomType(roomId, displayName) {
            if (roomId.startsWith('비상구')) {
                return 'emergency';
            }
            if (displayName.startsWith('화장실')) {
                return 'restroom';
            }
            if (/^\d+-\d+$/.test(displayName)) {
                return 'classroom';
            }
            return 'special';
        }

        // 층별 방 목록 생성
        function generateRoomList(floor) {
            const listContainer = document.getElementById(`room-list-${floor}`);
            if (!listContainer) return;

            listContainer.innerHTML = '';

            // 해당 층의 room-group 요소들을 찾아서 목록 생성
            const floorMap = document.querySelector(`.floor-map[data-floor="${floor}"]`);
            if (!floorMap) return;

            const roomGroups = floorMap.querySelectorAll('.room-group');
            const rooms = [];

            roomGroups.forEach(group => {
                const roomId = group.dataset.room;
                const displayName = roomDisplayNames[roomId] || roomId;
                const roomType = getRoomType(roomId, displayName);

                rooms.push({
                    id: roomId,
                    name: displayName,
                    type: roomType
                });
            });

            // 방 정렬 (비상구 먼저, 그 다음 방 번호순)
            rooms.sort((a, b) => {
                if (a.type === 'emergency' && b.type !== 'emergency') return -1;
                if (a.type !== 'emergency' && b.type === 'emergency') return 1;
                return a.id.localeCompare(b.id);
            });

            // 목록 아이템 생성
            rooms.forEach(room => {
                const item = document.createElement('div');
                item.className = 'room-list-item';
                item.dataset.roomId = room.id;
                item.dataset.floor = floor;

                item.innerHTML = `
                    <div class="room-list-item-id">${room.id}</div>
                    <div class="room-list-item-name">${room.name}</div>
                    <span class="room-list-item-badge ${room.type}">
                        ${room.type === 'emergency' ? '비상구' :
                          room.type === 'classroom' ? '교실' :
                          room.type === 'restroom' ? '화장실' : '특수교실'}
                    </span>
                `;

                // 클릭 이벤트 추가
                item.addEventListener('click', () => {
                    handleRoomListItemClick(room.id, floor);
                });

                listContainer.appendChild(item);
            });
        }

        // 목록 아이템 클릭 처리
        function handleRoomListItemClick(roomId, floor) {
            // 현재 층으로 전환
            switchFloor(floor);

            // 평면도 보기로 전환
            const viewBtns = document.querySelectorAll('.view-btn');
            viewBtns.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.view === 'plan') {
                    btn.classList.add('active');
                }
            });

            const floorMap = document.querySelector(`.floor-map[data-floor="${floor}"]`);
            if (floorMap) {
                // 모든 뷰 숨기기
                floorMap.querySelectorAll('[data-view-type]').forEach(view => {
                    view.style.display = 'none';
                });
                // 평면도만 표시
                const planView = floorMap.querySelector('[data-view-type="plan"]');
                if (planView) {
                    planView.style.display = 'block';
                }
            }

            // 평면도에서 해당 방 강조
            const roomGroup = floorMap.querySelector(`.room-group[data-room="${roomId}"]`);
            if (roomGroup) {
                // 기존 선택 해제
                floorMap.querySelectorAll('.room-group').forEach(group => {
                    group.classList.remove('selected');
                });

                // 선택 효과 추가
                roomGroup.classList.add('selected');

                // 방으로 스크롤
                roomGroup.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            // 목록에서도 선택 표시
            document.querySelectorAll('.room-list-item').forEach(item => {
                item.classList.remove('selected');
            });
            const listItem = document.querySelector(`.room-list-item[data-room-id="${roomId}"][data-floor="${floor}"]`);
            if (listItem) {
                listItem.classList.add('selected');
            }
        }

        // 사이드바 방 목록 업데이트
        function updateRoomsSidebar(floor) {
            const sidebarList = document.getElementById('rooms-sidebar-list');
            const sidebarSubtitle = document.getElementById('roomsSidebarSubtitle');

            if (!sidebarList) return;

            sidebarList.innerHTML = '';

            // 해당 층의 room-group 요소들을 찾아서 목록 생성
            const floorMap = document.querySelector(`.floor-map[data-floor="${floor}"]`);
            if (!floorMap) return;

            const roomGroups = floorMap.querySelectorAll('.room-group');
            const rooms = [];

            roomGroups.forEach(group => {
                const roomId = group.dataset.room;
                const displayName = roomDisplayNames[roomId] || roomId;
                const roomType = getRoomType(roomId, displayName);

                rooms.push({
                    id: roomId,
                    name: displayName,
                    type: roomType
                });
            });

            // 방 정렬 (비상구 먼저, 그 다음 방 번호순)
            rooms.sort((a, b) => {
                if (a.type === 'emergency' && b.type !== 'emergency') return -1;
                if (a.type !== 'emergency' && b.type === 'emergency') return 1;
                return a.id.localeCompare(b.id);
            });

            // 서브타이틀 업데이트
            if (sidebarSubtitle) {
                sidebarSubtitle.textContent = `${floor}층 - ${rooms.length}개 방`;
            }

            // 목록 아이템 생성
            rooms.forEach(room => {
                const item = document.createElement('div');
                item.className = 'room-list-item';
                item.dataset.roomId = room.id;
                item.dataset.floor = floor;

                const badgeText = room.type === 'emergency' ? '비상구' :
                                  room.type === 'classroom' ? '교실' :
                                  room.type === 'restroom' ? '화장실' : '특수교실';

                item.innerHTML = `
                    <div class="room-list-item-content">
                        <div class="room-list-item-id">${room.id}</div>
                        <div class="room-list-item-name">${room.name}</div>
                    </div>
                    <span class="room-list-item-badge ${room.type}">
                        ${badgeText}
                    </span>
                `;

                // 클릭 이벤트 추가 - 도면에서 방 클릭한 것처럼 동작
                item.addEventListener('click', () => {
                    // 현재 층으로 전환
                    if (currentFloor !== floor) {
                        switchFloor(floor);
                    }

                    // 해당 방의 room-group 찾기
                    const roomGroup = floorMap.querySelector(`.room-group[data-room="${room.id}"]`);
                    if (!roomGroup) return;

                    // 기존 선택 해제
                    document.querySelectorAll('.room-group.selected').forEach(g => {
                        g.classList.remove('selected');
                    });
                    document.querySelectorAll('.room-list-item.selected').forEach(li => {
                        li.classList.remove('selected');
                    });

                    // 방 선택
                    roomGroup.classList.add('selected');
                    item.classList.add('selected');

                    // 방으로 스크롤
                    const roomShape = roomGroup.querySelector('.room-shape');
                    if (roomShape) {
                        roomGroup.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }

                    // 경로 찾기 로직 (도면 클릭과 동일하게)
                    const nearestWp = findNearestWaypoint(roomShape);
                    if (nearestWp) {
                        selectedRooms.push({ room: room.id, waypoint: nearestWp });

                        if (selectedRooms.length === 2) {
                            // 경로 찾기 및 그리기
                            const startWp = selectedRooms[0].waypoint;
                            const endWp = selectedRooms[1].waypoint;
                            console.log(`Finding path from ${selectedRooms[0].room} (${startWp}) to ${selectedRooms[1].room} (${endWp})`);
                            const path = findPath(startWp, endWp);
                            console.log('Path found:', path);

                            if (path.length > 0) {
                                drawPath(path);
                            } else {
                                console.warn('No path found!');
                            }

                            // 선택 해제
                            document.querySelectorAll('.room-group.selected').forEach(g => {
                                g.classList.remove('selected');
                            });
                            document.querySelectorAll('.room-list-item.selected').forEach(li => {
                                li.classList.remove('selected');
                            });
                            selectedRooms = [];
                        }
                    }
                });

                sidebarList.appendChild(item);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const roomGroups = document.querySelectorAll('.room-group');

            // Add CSS animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes dash {
                    to {
                        stroke-dashoffset: 0;
                    }
                }
                @keyframes fadeIn {
                    to {
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);

            // 방 라벨 및 select 옵션 업데이트
            updateRoomLabels();
            updateSelectOptions();

            // 방 색상 적용
            applyRoomColors();

            // 모든 층의 방 목록 생성
            generateRoomList('4');
            generateRoomList('3');
            generateRoomList('2');
            generateRoomList('1');

            // 사이드바 초기화 (4층으로 시작)
            updateRoomsSidebar('4');

            roomGroups.forEach(group => {
                const roomShape = group.querySelector('.room-shape');
                if (roomShape) {
                    group.addEventListener('click', () => {
                        // Check if this room belongs to the current floor
                        const floorMap = group.closest('.floor-map');
                        if (!floorMap || floorMap.dataset.floor !== currentFloor) {
                            return; // Ignore clicks on rooms from other floors
                        }

                        const roomData = group.dataset.room;
                        if (roomData) {
                            // Find nearest waypoint to this room
                            const nearestWp = findNearestWaypoint(roomShape);

                            if (nearestWp) {
                                // Add to selected rooms with its nearest waypoint
                                selectedRooms.push({ room: roomData, waypoint: nearestWp });

                                // Highlight selected room
                                group.classList.add('selected');

                                if (selectedRooms.length === 2) {
                                    // Find and draw path
                                    const startWp = selectedRooms[0].waypoint;
                                    const endWp = selectedRooms[1].waypoint;
                                    console.log(`Finding path from ${selectedRooms[0].room} (${startWp}) to ${selectedRooms[1].room} (${endWp})`);
                                    const path = findPath(startWp, endWp);
                                    console.log('Path found:', path);

                                    if (path.length > 0) {
                                        drawPath(path);
                                    } else {
                                        console.warn('No path found!');
                                    }

                                    // 경로 유지 - 초기화 버튼 누를 때까지 유지
                                    document.querySelectorAll('.room-group.selected').forEach(g => {
                                        g.classList.remove('selected');
                                    });
                                    selectedRooms = [];
                                }
                            }
                        }
                    });

                    group.addEventListener('mouseenter', () => {
                        roomShape.style.transform = 'scale(1.02)';
                        roomShape.style.transformOrigin = 'center';
                    });

                    group.addEventListener('mouseleave', () => {
                        roomShape.style.transform = 'scale(1)';
                    });
                }
            });
        });

        // Floor switching
        floorButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const floor = btn.dataset.floor;
                switchFloor(floor);
            });
        });

        // View switching (평면도, 목록, 실제 이미지)
        const viewButtons = document.querySelectorAll('.view-btn');
        viewButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const viewType = btn.dataset.view;

                // 버튼 활성화 상태 변경
                viewButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // 현재 활성화된 층의 뷰 변경
                const activeFloorMap = document.querySelector('.floor-map.active');
                if (activeFloorMap) {
                    activeFloorMap.querySelectorAll('[data-view-type]').forEach(view => {
                        view.style.display = 'none';
                    });

                    const targetView = activeFloorMap.querySelector(`[data-view-type="${viewType}"]`);
                    if (targetView) {
                        targetView.style.display = 'block';
                    }
                }
            });
        });

        function switchFloor(floor) {
            currentFloor = floor;

            // Update buttons
            floorButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.floor === floor);
            });

            // Update maps
            floorMaps.forEach(map => {
                map.classList.toggle('active', map.dataset.floor === floor);
            });

            // Update title
            const floorNames = {
                '4': '4층',
                '3': '3층',
                '2': '2층',
                '1': '1층'
            };
            const floorLabel = document.getElementById('floorLabel');
            if (floorLabel) {
                floorLabel.textContent = floorNames[floor];
            } else {
                mapTitle.textContent = `${floorNames[floor]} 평면도`;
            }

            // 사이드바 업데이트
            updateRoomsSidebar(floor);

            // Reapply filters
            applyFilters();
        }

        // Filter by type - removed (no longer using category filters)

        // Search
        searchInput.addEventListener('input', (e) => {
            const value = e.target.value;
            clearBtn.style.display = value ? 'flex' : 'none';
            applyFilters();
        });

        clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            clearBtn.style.display = 'none';
            applyFilters();
        });

        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            const activeMap = document.querySelector(`.floor-map[data-floor="${currentFloor}"]`);
            const cards = activeMap.querySelectorAll('.room-card');
            const svgGroups = activeMap.querySelectorAll('.room-group');
            let visibleCount = 0;

            // Filter list view cards
            cards.forEach(card => {
                const roomNumber = card.querySelector('.room-number')?.textContent.toLowerCase() || '';
                const roomName = card.querySelector('.room-name')?.textContent.toLowerCase() || '';

                const matchesSearch = roomNumber.includes(searchTerm) || roomName.includes(searchTerm);

                if (matchesSearch) {
                    card.style.display = 'block';
                    card.classList.toggle('highlight', searchTerm && searchTerm.length > 0);
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                    card.classList.remove('highlight');
                }
            });

            // Filter SVG floor plan
            svgGroups.forEach(group => {
                const roomShape = group.querySelector('.room-shape');
                if (!roomShape) return;

                const roomLabel = group.querySelector('.room-label')?.textContent.toLowerCase() || '';
                const roomSublabel = group.querySelector('.room-sublabel')?.textContent.toLowerCase() || '';

                const matchesSearch = roomLabel.includes(searchTerm) || roomSublabel.includes(searchTerm);

                if (matchesSearch) {
                    group.style.display = 'block';
                    roomShape.classList.toggle('highlight', searchTerm && searchTerm.length > 0);
                    visibleCount++;
                } else {
                    group.style.display = 'none';
                    roomShape.classList.remove('highlight');
                }
            });

            noResults.classList.toggle('show', visibleCount === 0);
        }

        // Room card click - use for path selection
        roomCards.forEach(card => {
            card.addEventListener('click', () => {
                const roomData = card.dataset.room;
                if (roomData && roomToWaypoint[roomData]) {
                    // Add to selected rooms
                    selectedRooms.push(roomData);

                    // Highlight selected card
                    card.classList.add('selected');

                    if (selectedRooms.length === 2) {
                        // Find and draw path
                        const startWp = roomToWaypoint[selectedRooms[0]];
                        const endWp = roomToWaypoint[selectedRooms[1]];
                        const path = findPath(startWp, endWp);

                        if (path.length > 0) {
                            drawPath(path);
                        }

                        // 경로 유지 - 초기화 버튼 누를 때까지 유지
                        document.querySelectorAll('.room-group.selected').forEach(g => {
                            g.classList.remove('selected');
                        });
                        document.querySelectorAll('.room-card.selected').forEach(c => {
                            c.classList.remove('selected');
                        });
                        selectedRooms = [];
                    }
                }
            });
        });

        // Modal close
        closeModalBtn.addEventListener('click', () => {
            modal.classList.remove('show');
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('show');
            }
        });

        // Path Finding
        const startLocationSelect = document.getElementById('startLocation');
        const endLocationSelect = document.getElementById('endLocation');
        const findPathBtn = document.getElementById('findPathBtn');
        const clearPathBtn = document.getElementById('clearPathBtn');

        // 강제로 select box 텍스트 색상 적용
        function forceSelectColor(selectElement) {
            if (!selectElement) return;
            selectElement.style.color = '#0f172a';
            selectElement.style.setProperty('color', '#0f172a', 'important');
            selectElement.style.webkitTextFillColor = '#0f172a';
        }

        forceSelectColor(startLocationSelect);
        forceSelectColor(endLocationSelect);

        // 선택 변경 시에도 색상 유지
        if (startLocationSelect) {
            startLocationSelect.addEventListener('change', function() {
                forceSelectColor(this);
            });
        }
        if (endLocationSelect) {
            endLocationSelect.addEventListener('change', function() {
                forceSelectColor(this);
            });
        }

        if (findPathBtn) {
            findPathBtn.addEventListener('click', findPathLegacy);
        }
        if (clearPathBtn) {
            clearPathBtn.addEventListener('click', clearPath);
        }

        // Reset button (새로고침 버튼)
        const resetBtn = document.getElementById('resetBtn');
        if (resetBtn) {
            resetBtn.addEventListener('click', clearPath);
        }

        function findPathLegacy() {
            const start = startLocationSelect.value;
            const end = endLocationSelect.value;

            if (!start || !end) {
                showToast('출발지와 목적지를 모두 선택해주세요.', 'warning');
                return;
            }

            if (start === end) {
                showToast('출발지와 목적지가 같습니다.', 'warning');
                return;
            }

            // 이전 경로 모두 지우기
            clearPath();

            // 경로 찾기 시작 알림
            showToast(`${start}에서 ${end}까지 경로를 찾는 중...`, 'info', '경로 탐색');

            // 층 정보 추출 (방 이름에서 층 판별)
            const startFloor = getFloorFromRoom(start);
            const endFloor = getFloorFromRoom(end);

            // 같은 층인 경우: 기존 로직 사용
            if (startFloor === endFloor) {
                findPathSameFloor(start, end, startFloor);
                showToast('경로를 찾았습니다!', 'success', '완료');
            } else {
                // 다른 층인 경우: 층간 이동 로직 사용
                findPathDifferentFloor(start, end, startFloor, endFloor);
                showToast('층간 이동 경로를 찾았습니다!', 'success', '완료');
            }
        }

        // 방 이름에서 층 정보 추출
        function getFloorFromRoom(roomName) {
            if (roomName.startsWith('1-')) {
                return '1';
            } else if (roomName.startsWith('2-')) {
                return '2';
            } else if (roomName.startsWith('3-')) {
                return '3';
            } else if (roomName.startsWith('4-')) {
                return '4';
            } else if (['비상구1', '비상구2', '비상구3'].includes(roomName)) {
                // 비상구는 모든 층에 있으므로, 현재 활성화된 층 반환
                const activeFloor = document.querySelector('.floor-map.active');
                return activeFloor ? activeFloor.dataset.floor : '4';
            }
            return '4'; // 기본값
        }

        // 같은 층 경로 찾기
        function findPathSameFloor(start, end, floor) {
            console.log('findPathSameFloor called:', { start, end, floor });

            // 기존 단층 로직
            const mapContainer = document.querySelector('.map-container');
            mapContainer.classList.remove('dual-floor-view');

            // 오른쪽 사이드바 다시 표시
            const roomsSidebar = document.querySelector('.rooms-sidebar');
            if (roomsSidebar) {
                roomsSidebar.style.display = '';
            }

            // 해당 층 활성화
            switchFloor(floor);

            // SVG에서 시작과 끝 방 찾기
            const floorMap = document.querySelector(`.floor-map[data-floor="${floor}"]`);
            console.log('floorMap found:', floorMap);

            const startGroup = floorMap.querySelector(`.room-group[data-room="${start}"]`);
            const endGroup = floorMap.querySelector(`.room-group[data-room="${end}"]`);

            console.log('startGroup:', startGroup, 'endGroup:', endGroup);

            if (!startGroup || !endGroup) {
                alert('경로를 찾을 수 없습니다.');
                return;
            }

            const startShape = startGroup.querySelector('.room-shape');
            const endShape = endGroup.querySelector('.room-shape');

            // 가장 가까운 waypoint 찾기
            let startWp, endWp;

            // roomToWaypoint 매핑 우선 사용
            if (roomToWaypoint[start]) {
                startWp = roomToWaypoint[start];
            } else if (emergencyExits[start]) {
                startWp = emergencyExits[start].waypoint;
            } else {
                startWp = findNearestWaypoint(startShape);
            }

            if (roomToWaypoint[end]) {
                endWp = roomToWaypoint[end];
            } else if (emergencyExits[end]) {
                endWp = emergencyExits[end].waypoint;
            } else {
                endWp = findNearestWaypoint(endShape);
            }

            console.log('Waypoints found:', { startWp, endWp });

            if (!startWp || !endWp) {
                alert('경로를 찾을 수 없습니다. (웨이포인트 없음)');
                return;
            }

            // A* 알고리즘으로 경로 찾기
            const path = findPath(startWp, endWp);

            console.log('Path found:', path);

            if (path.length === 0) {
                alert('경로를 찾을 수 없습니다. (경로 계산 실패)');
                return;
            }

            // 방의 실제 좌표 계산
            let startX, startY, endX, endY;

            if (emergencyExits[start]) {
                startX = emergencyExits[start].x;
                startY = emergencyExits[start].y;
            } else {
                const startRect = startShape.getBBox();
                startX = startRect.x + startRect.width / 2;
                startY = startRect.y + startRect.height / 2;
            }

            if (emergencyExits[end]) {
                endX = emergencyExits[end].x;
                endY = emergencyExits[end].y;
            } else {
                const endRect = endShape.getBBox();
                endX = endRect.x + endRect.width / 2;
                endY = endRect.y + endRect.height / 2;
            }

            // 경로의 모든 포인트 배열 생성
            const points = [{ x: startX, y: startY }];
            path.forEach((wpId) => {
                const wp = waypoints[wpId];
                points.push({ x: wp.x, y: wp.y });
            });
            points.push({ x: endX, y: endY });

            // 화살표가 있는 경로 그리기
            drawPathWithArrowsSameFloor(points, start, end, floor);

            // 거리 및 시간 계산 (표시 제거됨)
            const distance = calculatePathDistance(path);
            const time = Math.ceil(distance / 80);
        }

        // 다른 층 경로 찾기 (층간 이동)
        function findPathDifferentFloor(start, end, startFloor, endFloor) {
            // 원본 지도의 모든 pathLayer 먼저 정리
            document.querySelectorAll('.floor-map').forEach(map => {
                const pathLayers = map.querySelectorAll('#pathLayer, .path-layer');
                pathLayers.forEach(layer => {
                    layer.innerHTML = '';
                });
                // 모든 경로 요소 제거
                map.querySelectorAll('.path-line, .path-marker, .direction-arrow, .turn-indicator').forEach(el => {
                    el.remove();
                });
            });

            // 두 층 지도를 나란히 표시
            const mapContainer = document.querySelector('.map-container');
            mapContainer.classList.add('dual-floor-view');

            // 오른쪽 사이드바 숨기기
            const roomsSidebar = document.querySelector('.rooms-sidebar');
            if (roomsSidebar) {
                roomsSidebar.style.display = 'none';
            }

            // 기존 floor-map 숨기기
            document.querySelectorAll('.floor-map').forEach(map => {
                if (!map.parentElement.classList.contains('dual-floor-item')) {
                    map.style.display = 'none';
                }
            });

            // dual-floor-container가 없으면 생성
            let dualContainer = document.querySelector('.dual-floor-container');
            if (!dualContainer) {
                dualContainer = document.createElement('div');
                dualContainer.className = 'dual-floor-container';

                // path-navigation 다음에 삽입
                const pathNav = document.querySelector('.path-navigation');
                pathNav.parentNode.insertBefore(dualContainer, pathNav.nextSibling);
            }

            // 출발지 층의 가장 가까운 비상구 찾기 (층간 이동 고려)
            const nearestExit = findNearestEmergencyExit(start, startFloor, endFloor);

            if (!nearestExit) {
                alert('층간 이동 가능한 비상구를 찾을 수 없습니다.');
                return;
            }

            // dual-floor-container 내용 구성 (두 번째 층은 숨김 처리)
            dualContainer.innerHTML = `
                <div class="dual-floor-item" data-floor-item="start">
                    <div class="dual-floor-label">
                        <i class="fas fa-map-marker-alt"></i>
                        ${startFloor}층 출발
                    </div>
                    <div class="path-instruction">
                        <i class="fas fa-route"></i>
                        ${getDisplayName(start)} → ${nearestExit} (비상구)
                    </div>
                    <div class="floor-map-clone" data-floor="${startFloor}"></div>
                </div>
                <div class="dual-floor-item dual-floor-hidden" data-floor-item="end">
                    <div class="dual-floor-label">
                        <i class="fas fa-flag-checkered"></i>
                        ${endFloor}층 도착
                    </div>
                    <div class="path-instruction">
                        <i class="fas fa-route"></i>
                        ${nearestExit} (비상구) → ${getDisplayName(end)}
                    </div>
                    <div class="floor-map-clone" data-floor="${endFloor}"></div>
                </div>
            `;

            // 각 층의 지도 복제
            const startFloorMap = document.querySelector(`.floor-map[data-floor="${startFloor}"]`);
            const endFloorMap = document.querySelector(`.floor-map[data-floor="${endFloor}"]`);

            const startClone = startFloorMap.cloneNode(true);
            const endClone = endFloorMap.cloneNode(true);

            // 복제된 지도의 pathLayer 정리 (이전 경로 제거)
            startClone.querySelectorAll('#pathLayer').forEach(layer => {
                layer.innerHTML = '';
            });
            endClone.querySelectorAll('#pathLayer').forEach(layer => {
                layer.innerHTML = '';
            });

            // 복제된 지도에서 이전 경로 요소들 제거
            startClone.querySelectorAll('.path-line, .path-marker, .direction-arrow, .turn-indicator, .path-layer').forEach(el => {
                if (el.classList.contains('path-layer')) {
                    el.innerHTML = '';
                } else {
                    el.remove();
                }
            });
            endClone.querySelectorAll('.path-line, .path-marker, .direction-arrow, .turn-indicator, .path-layer').forEach(el => {
                if (el.classList.contains('path-layer')) {
                    el.innerHTML = '';
                } else {
                    el.remove();
                }
            });

            startClone.classList.add('active');
            endClone.classList.add('active');

            dualContainer.querySelector(`.floor-map-clone[data-floor="${startFloor}"]`).appendChild(startClone);
            dualContainer.querySelector(`.floor-map-clone[data-floor="${endFloor}"]`).appendChild(endClone);

            // 양쪽 화면 동시 표시 및 경로 그리기
            // 좌측: 출발층 - 출발지에서 비상구까지
            drawPathOnFloor(start, nearestExit, startFloor, startClone, true);

            // 우측: 도착층 - 비상구에서 목적지까지 (동시에 표시)
            const endFloorItem = dualContainer.querySelector('[data-floor-item="end"]');
            endFloorItem.classList.remove('dual-floor-hidden');
            endFloorItem.classList.add('dual-floor-fadein');

            // 경로는 약간의 딜레이 후 그리기 (사용자가 화면 전환을 인지할 수 있도록)
            setTimeout(() => {
                drawPathOnFloor(nearestExit, end, endFloor, endClone, true);
            }, 500);
        }

        // 특정 층에 경로 그리기
        function drawPathOnFloor(startRoom, endRoom, floor, floorElement, animated = false) {
            // 비상구인 경우 미리 정의된 waypoint 사용
            let startWp, endWp;

            if (emergencyExits[startRoom]) {
                startWp = emergencyExits[startRoom].waypoint;
            } else {
                const startGroup = floorElement.querySelector(`.room-group[data-room="${startRoom}"]`);
                if (!startGroup) return;
                const startShape = startGroup.querySelector('.room-shape');
                startWp = findNearestWaypoint(startShape);
            }

            if (emergencyExits[endRoom]) {
                endWp = emergencyExits[endRoom].waypoint;
            } else {
                const endGroup = floorElement.querySelector(`.room-group[data-room="${endRoom}"]`);
                if (!endGroup) return;
                const endShape = endGroup.querySelector('.room-shape');
                endWp = findNearestWaypoint(endShape);
            }

            if (!startWp || !endWp) return;

            const path = findPath(startWp, endWp);
            if (path.length === 0) return;

            // SVG에 경로 그리기
            const svg = floorElement.querySelector('.floor-plan');
            if (!svg) return;

            let pathLayer = svg.querySelector('.path-layer');
            if (!pathLayer) {
                pathLayer = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                pathLayer.setAttribute('class', 'path-layer');
                svg.appendChild(pathLayer);
            } else {
                // 기존 경로 지우기
                pathLayer.innerHTML = '';
            }

            // 시작과 끝 위치 계산 (방의 실제 위치)
            let startX, startY, endX, endY;

            if (emergencyExits[startRoom]) {
                startX = emergencyExits[startRoom].x;
                startY = emergencyExits[startRoom].y;
            } else {
                const startGroup = floorElement.querySelector(`.room-group[data-room="${startRoom}"]`);
                if (startGroup) {
                    const startShape = startGroup.querySelector('.room-shape');
                    const startRect = startShape.getBBox();
                    startX = startRect.x + startRect.width / 2;
                    startY = startRect.y + startRect.height / 2;
                }
            }

            if (emergencyExits[endRoom]) {
                endX = emergencyExits[endRoom].x;
                endY = emergencyExits[endRoom].y;
            } else {
                const endGroup = floorElement.querySelector(`.room-group[data-room="${endRoom}"]`);
                if (endGroup) {
                    const endShape = endGroup.querySelector('.room-shape');
                    const endRect = endShape.getBBox();
                    endX = endRect.x + endRect.width / 2;
                    endY = endRect.y + endRect.height / 2;
                }
            }

            // 경로의 모든 포인트 배열 생성 (시작점 → waypoints → 끝점)
            const points = [{ x: startX, y: startY }];
            path.forEach((wpId) => {
                const wp = waypoints[wpId];
                points.push({ x: wp.x, y: wp.y });
            });
            points.push({ x: endX, y: endY });

            // 경로 선 그리기
            let pathD = `M ${startX} ${startY}`;
            path.forEach((wpId) => {
                const wp = waypoints[wpId];
                pathD += ` L ${wp.x} ${wp.y}`;
            });
            pathD += ` L ${endX} ${endY}`;

            const pathElement = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            pathElement.setAttribute('d', pathD);
            pathElement.setAttribute('stroke', '#667eea');
            pathElement.setAttribute('stroke-width', '4');
            pathElement.setAttribute('fill', 'none');
            pathElement.setAttribute('stroke-linecap', 'round');
            pathElement.setAttribute('stroke-linejoin', 'round');
            pathElement.setAttribute('class', 'path-line');

            // 애니메이션 효과 추가
            if (animated) {
                const length = pathElement.getTotalLength();
                pathElement.style.strokeDasharray = length + ' ' + length;
                pathElement.style.strokeDashoffset = length;
                pathElement.style.animation = 'pathDraw 2s ease-out forwards';
            }

            pathLayer.appendChild(pathElement);

            // 시작 마커 (방의 실제 위치에 표시)
            const startMarker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            startMarker.setAttribute('cx', startX);
            startMarker.setAttribute('cy', startY);
            startMarker.setAttribute('r', '8');
            startMarker.setAttribute('fill', '#22c55e');
            startMarker.setAttribute('stroke', 'white');
            startMarker.setAttribute('stroke-width', '2');
            startMarker.setAttribute('class', 'path-marker start-marker');
            if (animated) {
                startMarker.style.animation = 'markerPulse 1.5s ease-in-out infinite';
            }
            pathLayer.appendChild(startMarker);

            // 애니메이션 화살표 추가
            if (animated) {
                const arrowSpacing = 50;

                for (let i = 0; i < points.length - 1; i++) {
                    const p1 = points[i];
                    const p2 = points[i + 1];

                    const dx = p2.x - p1.x;
                    const dy = p2.y - p1.y;
                    const segmentLength = Math.sqrt(dx * dx + dy * dy);
                    const angle = Math.atan2(dy, dx) * 180 / Math.PI;

                    const numArrows = Math.max(1, Math.floor(segmentLength / arrowSpacing));

                    for (let j = 0; j < numArrows; j++) {
                        const t = (j + 0.5) / numArrows;
                        const arrowX = p1.x + dx * t;
                        const arrowY = p1.y + dy * t;

                        const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                        const arrowSize = 12;
                        const arrowPoints = `0,-${arrowSize/2} ${arrowSize*1.5},0 0,${arrowSize/2} ${arrowSize/3},0`;
                        arrow.setAttribute('points', arrowPoints);
                        arrow.setAttribute('class', 'direction-arrow');
                        arrow.setAttribute('transform', `translate(${arrowX}, ${arrowY}) rotate(${angle})`);
                        arrow.style.animationDelay = `${(i * numArrows + j) * 0.1}s`;

                        pathLayer.appendChild(arrow);
                    }
                }
            }

            // 끝 마커 (방의 실제 위치에 표시) - 화살표 다음에 추가
            const endMarker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            endMarker.setAttribute('cx', endX);
            endMarker.setAttribute('cy', endY);
            endMarker.setAttribute('r', '8');
            endMarker.setAttribute('fill', '#ef4444');
            endMarker.setAttribute('stroke', 'white');
            endMarker.setAttribute('stroke-width', '2');
            endMarker.setAttribute('class', 'path-marker end-marker');
            if (animated) {
                endMarker.style.animation = 'markerPulse 1.5s ease-in-out infinite 0.2s';
            }
            pathLayer.appendChild(endMarker);
        }

        // 경로 거리 계산
        function calculatePathDistance(path) {
            let distance = 0;
            for (let i = 1; i < path.length; i++) {
                const wp1 = waypoints[path[i - 1]];
                const wp2 = waypoints[path[i]];
                const dx = wp2.x - wp1.x;
                const dy = wp2.y - wp1.y;
                distance += Math.sqrt(dx * dx + dy * dy);
            }
            return Math.round(distance / 10); // 픽셀을 미터로 변환 (대략)
        }

        function drawPathWithArrowsSameFloor(points, start, end, floor) {
            console.log('drawPathWithArrowsSameFloor called:', { points, start, end, floor });

            // 지정된 층의 pathLayer를 찾기
            const floorMap = document.querySelector(`.floor-map[data-floor="${floor}"]`);
            console.log('floorMap:', floorMap);

            if (!floorMap) {
                console.warn('Floor map not found for floor:', floor);
                return;
            }

            const pathLayer = floorMap.querySelector('.floor-plan #pathLayer');
            console.log('pathLayer:', pathLayer);

            if (!pathLayer) {
                console.warn('Path layer not found for floor:', floor);
                return;
            }

            pathLayer.innerHTML = '';
            console.log('Drawing path with', points.length, 'points');

            // Draw path line
            let pathD = `M ${points[0].x} ${points[0].y}`;
            for (let i = 1; i < points.length; i++) {
                pathD += ` L ${points[i].x} ${points[i].y}`;
            }

            const pathLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            pathLine.setAttribute('d', pathD);
            pathLine.setAttribute('class', 'path-line');
            pathLayer.appendChild(pathLine);

            // Draw start marker
            const startMarker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            startMarker.setAttribute('cx', points[0].x);
            startMarker.setAttribute('cy', points[0].y);
            startMarker.setAttribute('r', '10');
            startMarker.setAttribute('class', 'path-marker start-marker');
            pathLayer.appendChild(startMarker);

            // Draw directional arrows along the path
            const arrowSpacing = 50; // Distance between arrows

            for (let i = 0; i < points.length - 1; i++) {
                const p1 = points[i];
                const p2 = points[i + 1];

                // Calculate distance between points
                const dx = p2.x - p1.x;
                const dy = p2.y - p1.y;
                const segmentLength = Math.sqrt(dx * dx + dy * dy);

                // Calculate angle
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;

                // Number of arrows to place on this segment
                const numArrows = Math.max(1, Math.floor(segmentLength / arrowSpacing));

                // Place multiple arrows along this segment
                for (let j = 0; j < numArrows; j++) {
                    const t = (j + 0.5) / numArrows; // Position along segment (0 to 1)
                    const arrowX = p1.x + dx * t;
                    const arrowY = p1.y + dy * t;

                    // Create arrow polygon
                    const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    const arrowSize = 12;
                    const arrowPoints = `0,-${arrowSize/2} ${arrowSize*1.5},0 0,${arrowSize/2} ${arrowSize/3},0`;
                    arrow.setAttribute('points', arrowPoints);
                    arrow.setAttribute('class', 'direction-arrow');
                    arrow.setAttribute('transform', `translate(${arrowX}, ${arrowY}) rotate(${angle})`);

                    // Add slight delay to animation for wave effect
                    arrow.style.animationDelay = `${(i * numArrows + j) * 0.1}s`;

                    pathLayer.appendChild(arrow);
                }

                // Add turn indicator at corner points (not start or end)
                if (i > 0 && i < points.length - 1) {
                    const turnCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    turnCircle.setAttribute('cx', p2.x);
                    turnCircle.setAttribute('cy', p2.y);
                    turnCircle.setAttribute('r', '8');
                    turnCircle.setAttribute('class', 'turn-indicator');
                    pathLayer.appendChild(turnCircle);
                }
            }

            // Draw end marker (마지막에 추가하여 화살표 위에 표시)
            const endMarker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            endMarker.setAttribute('cx', points[points.length - 1].x);
            endMarker.setAttribute('cy', points[points.length - 1].y);
            endMarker.setAttribute('r', '10');
            endMarker.setAttribute('class', 'path-marker end-marker');
            pathLayer.appendChild(endMarker);
        }

        function drawPathWithArrows(points, start, end) {
            // Get the path layer for the current floor
            const pathLayerId = 'pathLayer' + (currentFloor === 'basement' ? 'B' : currentFloor);
            const pathLayer = document.getElementById(pathLayerId);

            if (!pathLayer) {
                console.warn('Path layer not found for floor:', currentFloor);
                return;
            }

            pathLayer.innerHTML = '';

            // Draw path line
            let pathD = `M ${points[0].x} ${points[0].y}`;
            for (let i = 1; i < points.length; i++) {
                pathD += ` L ${points[i].x} ${points[i].y}`;
            }

            const pathLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            pathLine.setAttribute('d', pathD);
            pathLine.setAttribute('class', 'path-line');
            pathLayer.appendChild(pathLine);

            // Draw start marker
            const startMarker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            startMarker.setAttribute('cx', points[0].x);
            startMarker.setAttribute('cy', points[0].y);
            startMarker.setAttribute('r', '10');
            startMarker.setAttribute('class', 'path-marker start-marker');
            pathLayer.appendChild(startMarker);

            // Draw end marker
            const endMarker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            endMarker.setAttribute('cx', points[points.length - 1].x);
            endMarker.setAttribute('cy', points[points.length - 1].y);
            endMarker.setAttribute('r', '10');
            endMarker.setAttribute('class', 'path-marker end-marker');
            pathLayer.appendChild(endMarker);

            // Draw directional arrows along the path
            const arrowSpacing = 50; // Distance between arrows

            for (let i = 0; i < points.length - 1; i++) {
                const p1 = points[i];
                const p2 = points[i + 1];

                // Calculate distance between points
                const dx = p2.x - p1.x;
                const dy = p2.y - p1.y;
                const segmentLength = Math.sqrt(dx * dx + dy * dy);

                // Calculate angle
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;

                // Number of arrows to place on this segment
                const numArrows = Math.max(1, Math.floor(segmentLength / arrowSpacing));

                // Place multiple arrows along this segment
                for (let j = 0; j < numArrows; j++) {
                    const t = (j + 0.5) / numArrows; // Position along segment (0 to 1)
                    const arrowX = p1.x + dx * t;
                    const arrowY = p1.y + dy * t;

                    // Create arrow polygon
                    const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    const arrowSize = 12;
                    const arrowPoints = `0,-${arrowSize/2} ${arrowSize*1.5},0 0,${arrowSize/2} ${arrowSize/3},0`;
                    arrow.setAttribute('points', arrowPoints);
                    arrow.setAttribute('class', 'direction-arrow');
                    arrow.setAttribute('transform', `translate(${arrowX}, ${arrowY}) rotate(${angle})`);

                    // Add slight delay to animation for wave effect
                    arrow.style.animationDelay = `${(i * numArrows + j) * 0.1}s`;

                    pathLayer.appendChild(arrow);
                }

                // Add turn indicator at corner points (not start or end)
                if (i > 0 && i < points.length - 1) {
                    const turnCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    turnCircle.setAttribute('cx', p2.x);
                    turnCircle.setAttribute('cy', p2.y);
                    turnCircle.setAttribute('r', '8');
                    turnCircle.setAttribute('class', 'turn-indicator');
                    pathLayer.appendChild(turnCircle);
                }
            }
        }


        function calculateDistance(points) {
            let total = 0;
            for (let i = 1; i < points.length; i++) {
                const dx = points[i].x - points[i-1].x;
                const dy = points[i].y - points[i-1].y;
                total += Math.sqrt(dx * dx + dy * dy);
            }
            // Convert SVG units to meters (approximate)
            return Math.round(total / 5);
        }

        function getRouteName(id) {
            const option = document.querySelector(`option[value="${id}"]`);
            return option ? option.textContent.replace(/🚩|🎯/g, '').trim() : id;
        }

        function clearPath() {
            // Clear path for all floors - ID 기반
            ['pathLayer4', 'pathLayer3', 'pathLayer2', 'pathLayer1'].forEach(layerId => {
                const pathLayer = document.getElementById(layerId);
                if (pathLayer) {
                    pathLayer.innerHTML = '';
                }
            });

            // Clear all pathLayers by querySelector (추가 안전장치)
            document.querySelectorAll('#pathLayer').forEach(layer => {
                layer.innerHTML = '';
            });

            // Clear dual-floor view
            const dualContainer = document.querySelector('.dual-floor-container');
            if (dualContainer) {
                dualContainer.remove();
            }

            // Remove dual-floor-view class
            const mapContainer = document.querySelector('.map-container');
            if (mapContainer) {
                mapContainer.classList.remove('dual-floor-view');
            }

            // 오른쪽 사이드바 다시 표시
            const roomsSidebar = document.querySelector('.rooms-sidebar');
            if (roomsSidebar) {
                roomsSidebar.style.display = '';
            }

            // Restore original floor-map display
            document.querySelectorAll('.floor-map').forEach(map => {
                map.style.display = '';
            });

            // Clear any path-layer in cloned SVGs
            document.querySelectorAll('.path-layer').forEach(layer => {
                layer.remove();
            });

            // Clear path-line, path-marker, direction-arrow elements
            document.querySelectorAll('.path-line, .path-marker, .direction-arrow, .turn-indicator').forEach(el => {
                el.remove();
            });

            // 출발지와 목적지는 유지 (사용자가 계속 확인할 수 있도록)
            // startLocationSelect.value = '';
            // endLocationSelect.value = '';
        }

        // Initialize
        applyFilters();
    </script>
</body>
</html>
